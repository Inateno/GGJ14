/*
 ___ ___ ___ ___ ___ ____ ___ ___ ___ ___ ___ ____ ___ ___ ___ ___ ___ _____ ___ ___ ___ ___ ___ ____ ___ ___
/    ____    ____    ____   _____   _      _     ____   __    _   ______   _   __    _   ____                \
|   |    \  |  _ \  |  __| /  _  \ | \    / |   |  __| |  \  | | /  ____| |_| |  \  | | |  __|      <|>      |
|   | |\  | | |_\ | | |__  | |_| | |  \  /  |   | |__  |   \ | | | |  __   _  |   \ | | | |__    /|_/|\_|\   |
|   | | | | |  _ /  |  __| |  _  | |   \/   |   |  __| | |\ \| | | | |_ | | | | |\ \| | |  __|  <<---X--->>  |
|   | |/  | | | |\  | |__  | | | | | |\__/| |   | |__  | | \   | | |___|| | | | | \   | | |__    \| \|/ |/   |
|   |____/  |_| |_\ |____| |_| |_| |_|    |_|   |____| |_|  \__| \______/ |_| |_|  \__| |____|      <|>      |
\___________________________________________________________________________________________________________/

-- by Inateno aka Rogliano Antoine for Dreamirl and all HTML5 lovers --
@DreamirlGames - http://dreamirl.com
@Inateno - http://inateno.com

The Dreamengine is released under the MIT License : http://opensource.org/licenses/MIT
You can't sell the engine, but game made with could be.

The Dreamengine use:
- RequireJS (module loader)                 -->    requirejs.org
- stashJS (localStorage)    by Rezitech     -->    rezitech.github.io/stash
- buzz (audio lib)          by Jay Salvat   -->    buzz.jaysalvat.com
- hand (mouse & touch)      by David Catuhe -->    handjs.codeplex.com

DreamEngine version 0.0.1a

*/

/*! Stash v1.2.4 MIT/GPL2 @rezitech */

define("DE.CONFIG",[],function(){var e={};return e.DEName="CONFIG",e.DEBUG=0,e.DEBUG_LEVEL=0,e.COLLISION_TYPE={ORIENTED_BOX:1,FIXED_BOX:2,CIRCLE:3},e.DEFAULT_SIZES={BUTTON:{WIDTH:120,HEIGHT:50,OFFSET_TOP:10,FONT_SIZE:25},GUI:{WIDTH:100,HEIGHT:100}},e.debug={log:function(t,n){if(e.DEBUG&&(!n||e.DEBUG_LEVEL>=n)){var r=[];for(var i in arguments)r.push(arguments[i]);r.splice(1,1),console.log.apply(console,r)}}},e.notifications={gamepadEnable:!0,gamepadAvalaible:"Gamepad avalaible !",gamepadChange:!0},e.debug.log("CONFIG loaded",3),e}),define("DE.COLORS",["DE.CONFIG"],function(e){var t={};return t.DEName="COLORS",t.defaultColor="white",t.DEBUG={},t.DEBUG.GAME_OBJECT="white",t.DEBUG.GUI="purple",t.DEBUG.X_AXIS="blue",t.DEBUG.Y_AXIS="red",t.DEBUG.COLLIDER="rgb(205,20,100)",t.DEBUG.CIRCLE_COLLIDER="rgb(205,50,100)",e.debug.log("COLORS loaded",3),t}),define("DE.Event",["DE.CONFIG"],function(e){var t=new function(){this.DEName="Event"};t.callbacks={},t.contexts={},t.persistents={},t.on=function(e
,n,r,i){t.callbacks[e]||(t.callbacks[e]=new Array,t.contexts[e]=new Array,t.persistents[e]=new Array),t.callbacks[e].push(n),t.contexts[e].push(r||window),t.persistents[e].push(i!==undefined?i:!0)},t.emit=function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),r=t.callbacks[n]||[],i=t.contexts[n]||[],s=t.persistents[n]||[];for(var o=0;o<r.length;o++)r[o].apply(i[o],e),s[o]||(delete r[o],delete i[o],delete s[o],r.splice(o,1),i.splice(o,1),s.splice(o,1),--o)},t.trigger=t.emit,e.debug.log("Event loaded",3),t.addEventComponents=function(e){e.callbacks={},e.contexts={}},t.addEventCapabilities=function(e){e.prototype?(e.prototype.on=n,e.prototype.emit=r,e.prototype.trigger=r,e.prototype.stopListen=i):(e.callbacks={},e.contexts={},e.on=n,e.emit=r,e.trigger=r,e.stopListen=i)};var n=function(e,t,n){this.callbacks[e]||(this.callbacks[e]=[],this.contexts[e]=[]),this.callbacks[e].push(t),this.contexts[e].push(n||this)},r=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),
n=this.callbacks[t]||[];for(var r=0;r<n.length;++r)n[r].apply(this.contexts[t][r],e)},i=function(e,t){if(!t)return delete this.callbacks[e],!0;for(var n in this.callbacks[e])if(this.callbacks[e][n]==t)return this.callbacks[e].splice(n,1),this.contexts[e].splice(n,1),!0;return!1};return e.debug.log("Event classes loaded",3),t}),define("DE.Time",["DE.CONFIG","DE.Event"],function(e,t){var n=new function(){this.DEName="Time",this.deltaTime=1,this.missedFrame=0,this.lastCalcul=Date.now(),this.scaleDelta=1,this.currentTime=Date.now(),this.lastRender=Date.now(),this.fps=0,this.FPS=30,this.update=function(){return this.currentTime=Date.now(),this.timeSinceLastFrame=this.currentTime-this.lastCalcul,this.timeSinceLastFrame<14?!1:(this.fps=Math.floor(1e3/this.timeSinceLastFrame),this.deltaTime=this.timeSinceLastFrame/16*this.scaleDelta,this.missedFrame=this.deltaTime,this.deltaTime>2&&(this.deltaTime=this.deltaTime%1,this.deltaTime<1&&(this.deltaTime+=1)),this.deltaTime<0&&(this.deltaTime+=1),this
.missedFrame=this.missedFrame-this.deltaTime,this.timeSinceLastFrameScaled=(this.currentTime-this.lastRender)*this.scaleDelta,this.lastRender=this.currentTime,this.lastCalcul=this.currentTime,!0)},this.getDelta=function(){return this.deltaTime}};return t.on("isInited",function(){n.deltaTime=0,n.lastCalcul=Date.now()}),e.debug.log("Time loaded",3),n}),define("DE.Vector2",["DE.Time","DE.CONFIG"],function(e,t){function n(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0,this.rotation=0;var o=0,u=0;return this.setRotation=function(e){return this.rotation=e%(r*2),this.rotation==0?(u=0,o=0):(u=Math.sin(this.rotation),o=Math.cos(this.rotation)),this.rotation},this.setPosition=function(e,t){return e.x&&e.y?(this.x=e.x,this.y=e.y,this):(this.x=e,this.y=t,this)},this.rotate=function(t,n){return n?this.setRotation(this.rotation+t):this.setRotation(this.rotation+t*e.deltaTime)},this.multiply=function(e){return this.x*=e,this.y*=e,this},this.translate=function(t,n,r){if(!t.x&&t.x!=0||!t.y&&t.y!=0)throw new 
Error(t+" is not a Vector2");if(!r)var t={x:t.x*e.deltaTime>>0,y:t.y*e.deltaTime>>0};return n?(this.x+=t.x>>0,this.y+=t.y>>0):o&&u?(this.x-=-t.x*o+t.y*u>>0,this.y-=-t.x*u+t.y*-o>>0):(this.x+=t.x>>0,this.y+=t.y>>0),this},this.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return this.x=this.x/e,this.y=this.y/e,this},this.getVector=function(e,t){if(!e.x&&e.x!=0||!e.y&&e.y!=0||!t.x&&t.x!=0||!t.y&&t.y!=0)throw new Error("Vector2 need two Vector2 to return getVector");return this.x=t.x-e.x,this.y=t.y-e.y,this},this.dotProduct=function(e,t){if(!e.x||!e.y)throw new Error("Vector2 need two Vector2 to return dotProduct");return t.x?e.x*t.x+e.y*t.y:this.x*e.x+this.y*e.y},this.getAngle=function(e,t){var r=null;t.x?r=(new n(t.x,t.y)).normalize():r=(new n(this.x,this.y)).normalize();var i=(new n(e.x,e.y)).normalize();return Math.acos(i.dotProduct(r))},this.getDistance=function(e){var t=this.x-e.x;t*=t;var n=this.y-e.y;return n*=n,Math.sqrt(t+n)>>0},this.isInRangeFrom=function(e,t)
{t*=t;var n=this.x-e.x;n*=n;var r=this.y-e.y;r*=r;var i=n+r;return i<=t?!0:!1},this.getHarmonics=function(e){return e?{cos:Math.cos(e),sin:Math.sin(e)}:{cos:o,sin:u}},this}var r=Math.PI;return n.prototype.DEName="Vector2",t.debug.log("Vector2 loaded",3),n}),define("DE.Sizes",["DE.CONFIG"],function(e){function t(e,t,n,r){if(!e||!t)throw new Error("Sizes :: You have to pass a width and height when instantiate -- see the doc");this.width=e,this.height=t,this.scaleX=n||1,this.scaleY=r||1,this.setScale=function(e,t){return e.x&&e.y?(this.scaleX=e.x,this.scaleY=e.y):t?(this.scaleX=e,this.scaleY=t):(this.scaleX=e,this.scaleY=e),this},this.scaleTo=function(e,t){return e.x&&e.y?(this.scaleX=e.x,this.scaleY=e.y):(this.scaleX=e,this.scaleY=e),this},this.scaleXTo=function(e,t){this.scaleX=valX},this.scaleYTo=function(e){this.scaleY=valY},this.setSizes=function(e,t){return e.width?(this.width=e.width,this.height=e.height||this.height):e&&!t?(this.width=e,this.height=e):(this.width=e,this.height=t),this
}}return t.prototype.DEName="Sizes",e.debug.log("Sizes loaded",3),t}),define("DE.States",["DE.Event","DE.CONFIG"],function(e,t){var n={isLoadingImages:!1,isReady:!1,isInited:!1,isLoading:!0},r=new function(){this.DEName="States",this.up=function(r){t.debug.log("State up "+r,3),i(r,!0),e.emit(r,!0),n[r]=!0},this.down=function(r){t.debug.log("State down "+r,3),i(r,!1),e.emit("not"+r,!1),n[r]=!1},this.get=function(e){return n[e]}},i=function(e,t){if(e=="isReady"||e=="isLoading")return;var i=n;(!i.isLoadingImages||e=="isLoadingImages"&&t===!1)&&(i.isInited||e=="isInited"&&t===!0)&&r.up("isReady")};return t.debug.log("states loaded",3),r}),define("DE.CanvasBuffer",["DE.CONFIG"],function(e){function t(e,t){if(!e||!t)throw new Error("CanvasBuffer :: can't instantiate a buffer with a width or a height 0 -- see the doc");this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!0,this.ctx.webkitImageSmoothingEnabled=!0
,this.resize=function(e,t){this.canvas.width=e,this.canvas.height=t},this.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}return t.prototype.DEName="CanvasBuffer",e.debug.log("CanvasBuffer loaded",3),t}),define("DE.ImageManager",["DE.CONFIG","DE.States","DE.Event","DE.CanvasBuffer"],function(e,t,n,r){var i=new function(){this.DEName="ImageManager",this.images={},this.imagesLoaded=0,this.imagesRequested=0,this.defaultImages=[],this.pathPrefix="",this.imageNotRatio=!1,this.ratioToConception=1,this.folderName="img",this.arrayLoader=function(n){if(!n){e.debug.log("%cno images loaded",1,"color:red");return}var r=n;for(var i=0,s;i<r.length;++i){s=r[i];if(!s||(s[3]||{}).load===!1)continue;this.pushImage(s[0],s[1],s[2],s[3])}n.length==0&&setTimeout(function(){t.down("isLoadingImages")},10)},this.pushImage=function(n,r,s,o){o=o||{},this.images[n]=new Image;var u=this.images[n];u.src=this.folderName+"/"+this.pathPrefix+r+"."+s,u.name=n,u.totalFrame=o.totalFrame||1,u
.totalLine=o.totalLine||1,u.eachAnim=o.eachAnim||0,u.isReversed=o.isReversed||!1,u.isAnimated=o.isAnimated||!1,u.isPaused=o.isPaused||!1,u.isLoop=o.isLoop!=undefined?o.isLoop:!0,u.totalFrame<=1&&(u.isAnimated=!1),u.onload=function(){i.imageLoaded(this)},this.imagesRequested++,t.up("isLoadingImages"),e.debug.log("LoadImage "+n,3)},this.imageLoaded=function(i){e.debug.log("Image:"+i.name+" correctly loaded",3);var s=new r(i.width,i.height),o=s.canvas,u=s.ctx;this.imageNotRatio&&(o.width=o.width*this.ratioToConception,o.height=o.height*this.ratioToConception),o.name=i.name,o.totalFrame=i.totalFrame,o.totalLine=i.totalLine,o.eachAnim=i.eachAnim,o.isReversed=i.isReversed,o.isAnimated=i.isAnimated,o.isPaused=i.isPaused,o.isLoop=i.isLoop,o.widthFrame=o.width/o.totalFrame>>0,o.heightFrame=o.height/o.totalLine>>0,u.drawImage(i,0,0,o.width,o.height),this.images[i.name]=o,this.imagesLoaded++,this.imagesLoaded==this.imagesRequested&&t.down("isLoadingImages"),n.emit("imageLoaded",this.imagesLoaded,this
.imagesRequested,i.name)}};return e.debug.log("ImageManager loaded",3),i}),define("DE.CollisionSystem",["DE.CONFIG"],function(e){var t=new function(){this.DEName="CollisionSystem",this.pointFixedBoxCollision=function(e,t){var n=t.getRealPosition?t.getRealPosition():{x:t.x,y:t.y};return e.x>=n.x&&e.x<n.x+t.width&&e.y>=n.y&&e.y<n.y+t.height?!0:!1},this.fixedBoxCollision=function(e,t){var n=e.getRealPosition?e.getRealPosition():{x:e.x,y:e.y},r=t.getRealPosition?t.getRealPosition():{x:t.x,y:t.y};return r.x>=n.x+e.width||r.x+t.width<=n.x||r.y>=n.y+e.height||r.y+t.height<=n.y?!1:!0},this.pointCircleCollision=function(e,t){var n=t.getRealPosition(),r=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y);return r>t.radius*t.radius?!1:!0},this.circleCollision=function(e,t){var n=(t.radius+e.radius)*(t.radius+e.radius),r=e.getRealPosition(),i=t.getRealPosition(),s=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y);return s<n?!0:!1},this.orientedBoxCollision=function(e,t){var n=e.getExternCircle(),r=t.getExternCircle(),i=
n.radius+r.radius;i*=i;var s=e.getRealPosition(),o=t.getRealPosition(),u=(o.x-s.x)*(o.x-s.x)+(o.y-s.y)*(o.y-s.y);return u>i?!1:!0},this.fixedBoxWithOrientedBoxCollision=function(e,t){},this.orientedBoxWithCircleCollision=function(e,t){},this.fixedBoxWithCircleCollision=function(e,t){},this.checkCollisionWith=function(t,n){if(n.type==t.type){switch(t.type){case e.COLLISION_TYPE.FIXED_BOX:return this.fixedBoxCollision(t,n);case e.COLLISION_TYPE.CIRCLES:return this.circleCollision(t,n);case e.COLLISION_TYPE.ORIENTED_BOX:return this.orientedBoxCollision(t,n)}return null}if(!t.type||!n.type){var r=t,i=n;n.type||(r=n,i=t);switch(i.type){case e.COLLISION_TYPE.CIRCLE:return this.pointCircleCollision(r,i);case e.COLLISION_TYPE.FIXED_BOX:return this.pointFixedBoxCollision(r,i)}return null}return n.type==e.COLLISION_TYPE.ORIENTED_BOX&&t.type==e.COLLISION_TYPE.FIXED_BOX?this.fixedBoxWithOrientedBoxCollision(t,n):n.type==e.COLLISION_TYPE.FIXED_BOX&&t.type==e.COLLISION_TYPE.ORIENTED_BOX?this.fixedBoxWithOrientedBoxCollision
(n,t):n.type==e.COLLISION_TYPE.CIRCLE&&t.type==e.COLLISION_TYPE.ORIENTED_BOX?this.orientedBoxWithCircleCollision(t,n):n.type==e.COLLISION_TYPE.ORIENTED_BOX&&t.type==e.COLLISION_TYPE.CIRCLE?this.orientedBoxWithCircleCollision(n,t):n.type==e.COLLISION_TYPE.CIRCLE&&t.type==e.COLLISION_TYPE.FIXED_BOX?this.fixedBoxWithCircleCollision(t,n):n.type==e.COLLISION_TYPE.FIXED_BOX&&t.type==e.COLLISION_TYPE.CIRCLE?this.fixedBoxWithCircleCollision(n,t):null}};return e.debug.log("CollisionSystem loaded",3),t}),define("DE.Collider",["DE.Vector2","DE.CONFIG"],function(e,t){function n(t){t=t||{},this.type=t.type||undefined,this.gameObject=t.gameObject||undefined,this.localPosition=t.localPosition||new e(t.offsetX||t.offsetLeft||0,t.offsetY||t.offsetTop||0),this.isColliding=!1,this.isTrigger=t.isTrigger||!1,this.collideWith=new Array,this.getRealPosition=function(){var e=this.gameObject.getPos();return e.x+=this.localPosition.x,e.y+=this.localPosition.y,e},this.debugRender=function(e,t,n){if(!this.debugBuffer
)return;e.drawImage(this.debugBuffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.debugBuffer.canvas.width*t*n>>0,this.debugBuffer.canvas.height*t*n>>0)}}return n.prototype.DEName="Collider",t.debug.log("Collider loaded",3),n}),define("DE.Renderer",["DE.COLORS","DE.Vector2","DE.CONFIG"],function(e,t,n){function r(n){n=n||{},this.gameObject=n.gameObject||undefined,this.alpha=n.alpha||1,this.fillColor=n.fillColor||e.defaultColor,this.strokeColor=n.strokeColor||e.defaultColor,this.method=n.method||"fill",this.localPosition=n.localPosition||new t(n.offsetx||n.offsetX||n.left||n.x||n.offsetLeft||0,n.offsety||n.offsetY||n.top||n.y||n.offsetTop||0),this.setScale=function(e,t){if(!this.sizes)return;t=t||e,this.localPosition.x+=this.sizes.width*this.sizes.scaleX*.5>>0,this.localPosition.y+=this.sizes.height*this.sizes.scaleY*.5>>0,this.sizes.setScale(e,t),this.localPosition.x-=this.sizes.width*this.sizes.scaleX*.5>>0,this.localPosition.y-=this.sizes.height*this.sizes.scaleY*.5>>0
},this.scale=function(e,t){if(!this.sizes)return;this.setScale(this.sizes.scaleX+(e||0),this.sizes.scaleY+(t||0))}}return r.prototype={constructor:r,translate:function(e){this.localPosition.translate(e,!0,!0)},translateX:function(e){this.translate({x:e,y:0})},translateY:function(e){this.translate({x:0,y:e})}},r.prototype.render=function(e,t,n){},r.prototype.DEName="Renderer",n.debug.log("Renderer loaded",3),r}),define("DE.GameObject.render",["DE.CONFIG","DE.COLORS","DE.Time"],function(e,t,n){function r(n,r,i,s,o){if(this.disable)return;r=r||1,i=i||1,s=s||{x:0,y:0},o=o||{width:0,height:0};if(this.renderers.length==0&&this.childrens.length==0&&!e.DEBUG)return;this.parent?n.translate((this.position.x-s.x)*r*i>>0,(this.position.y-s.y)*r*i>>0):n.translate((this.position.x-s.x)*r>>0,(this.position.y-s.y)*r>>0),n.rotate(this.position.rotation);for(var u=0,a;a=this.renderers[u];u++)a.render(n,r,i);e.DEBUG_LEVEL>1&&(n.fillStyle=t.DEBUG.GAME_OBJECT,n.fillRect(0,0,1,1),n.fillStyle=t.DEBUG.X_AXIS,n
.fillRect(0,0,20,2),n.fillStyle=t.DEBUG.Y_AXIS,n.fillRect(0,0,2,20),this.collider!==null&&this.collider.debugRender(n,r,i));for(var u=0,f;f=this.childrens[u];u++)f.render(n,r,i);n.rotate(-this.position.rotation),this.parent?n.translate(-(this.position.x-s.x)*r*i>>0,-(this.position.y-s.y)*r*i>>0):n.translate(-(this.position.x-s.x)*r>>0,-(this.position.y-s.y)*r>>0)}return e.debug.log("GameObject.render loaded",3),r}),define("DE.GameObject.update",["DE.CollisionSystem","DE.CONFIG","DE.Time"],function(e,t,n){function r(e){if(this.disable)return;for(var t in this.automatism){var r=this.automatism[t];if(e-r.lastCall<r.interval/n.scaleDelta)continue;r.lastCall=e,this[r.type](r.value1,r.value2),r.persistant||delete this.automatism[t]}for(var i=0;child=this.childrens[i];i++)child.update(e);if(!this.isMoved||!this.collider)return}return t.debug.log("GameObject.update loaded",3),r}),define("DE.GameObject",["DE.Vector2","DE.GameObject.render","DE.GameObject.update","DE.CONFIG","DE.Sizes","DE.Event"
],function(e,t,n,r,i,s){function o(t){t=t||{},this.id=t.id||Math.random()*999999999,this.name=t.name||"",this.tag=t.tag||"none",this.scene=null,this.disable=!1,this.sceneIndex=0,this.parent=t.parent||undefined,this.childrens=t.childrens||new Array,this.position=t.position||new e(t.x||0,t.y||0,t.z||0),this.parentPosition=null,this.biggerOffset=new i(1,1,1,1),this.automatism={},this.flag=null,this.zindex=t.zindex||0,this.renderers=new Array;if(t.renderers&&t.renderers.length>0)for(var n=0,r;r=t.renderers[n];n++)r.gameObject=this,this.addRenderer(r);t.renderer&&(t.renderer.gameObject=this,this.addRenderer(t.renderer)),this.indexMouseOver=[0,0,0,0,0,0,0,0,0,0,0,0],this.isMoved=!1,this.collider=t.collider||null,this.collider!==null&&(this.collider.gameObject=this),this.rigibody=t.rigibody||undefined,this.rigibody&&this.rigibody.gameObject!=this&&(this.rigibody.gameObject=this),s.addEventComponents(this)}var u=Math.PI;return o.prototype={constructor:o,translate:function(e,t){this.moved(),t=t||!1
,this.position.translate(e,t)},translateX:function(e,t){t=t||!1,this.translate({x:e,y:0},t)},translateY:function(e,t){t=t||!1,this.translate({x:0,y:e},t)},getPos:function(){if(this.parent){var e=this.parent.getPos(),t=this.getHarmonics();return t.sin==0&&t.cos==0?{x:this.position.x+e.x,y:this.position.y+e.y,z:this.position.z+e.z}:{x:-(-this.position.x*t.cos+this.position.y*t.sin)+e.x,y:-(-this.position.x*t.sin+this.position.y*-t.cos)+e.y,z:this.position.z+e.z}}return{x:this.position.x,y:this.position.y,z:this.position.z}},getHarmonics:function(){return this.parent?this.position.getHarmonics(this.parent.getRotation()):this.position.getHarmonics()},getRotation:function(){return this.parent?(this.position.rotation+this.parent.getRotation())%(u*2):this.position.rotation%(u*2)},rotate:function(e){this.moved(),this.position.rotate(e)},lookAt:function(e){this.moved();if(this.parent){var t=this.getPos();this.position.setRotation(-Math.atan2(e.x-t.x,e.y-t.y)-this.parent.getRotation());return}this
.position.setRotation(-Math.atan2(e.x-this.position.x,e.y-this.position.y)+u)},add:function(e){if(e===this){console.warn("DREAM_ENGINE.GameObject.add: An object can't be added as a child of itself.");return}if(e instanceof o){e.parent!==undefined&&e.parent.remove(e),e.parent=this,e.parentPosition=this.position,this.childrens.push(e);if(e.renderers.length>0){var t=e.position.x,n=e.position.y;for(var r=0,i;i=e.renderers[r];r++)i.sizes?(t+i.sizes.width>this.biggerOffset.width?this.biggerOffset.width=t+i.sizes.width:t-i.sizes.width>this.biggerOffset.width&&(this.biggerOffset.width=t-i.sizes.width),n+i.sizes.height>this.biggerOffset.height?this.biggerOffset.height=n+i.sizes.height:n-i.sizes.height>this.biggerOffset.height&&(this.biggerOffset.height=n-i.sizes.height)):i.radius&&(t+i.radius>this.biggerOffset.width?this.biggerOffset.width=t+i.radius:t-i.radius>this.biggerOffset.width&&(this.biggerOffset.width=t-i.radius),n+i.radius>this.biggerOffset.height?this.biggerOffset.height=n+i.radius:n-
i.radius>this.biggerOffset.height&&(this.biggerOffset.height=n-i.radius))}}},remove:function(e){var t=this.childrens.indexOf(e);t!==-1&&(e.parent=undefined,e.parentPosition=null,this.childrens.splice(t,1))},getChildByName:function(e,t){var n,r;for(n=0;r=this.childrens[n];n++){if(r.name===e)return r;if(t){r=r.getChildByName(e,t);if(r!==undefined)return r}}return undefined},moved:function(){var e=this;while(e.parent!==undefined)e=e.parent;return e.isMoved=!0,this},addRenderer:function(e){return e.gameObject=this,this.renderers.push(e),e.sizes?(e.sizes.width>this.biggerOffset.width&&(this.biggerOffset.width=e.sizes.width),e.sizes.height>this.biggerOffset.height&&(this.biggerOffset.height=e.sizes.height)):e.radius&&(e.radius>this.biggerOffset.width&&(this.biggerOffset.width=e.radius),e.radius>this.biggerOffset.height&&(this.biggerOffset.height=e.radius)),this}},o.prototype.delete=function(e){if(this.childrens[e]){this.childrens[e].killMePlease(),delete this.childrens[e],this.childrens.splice
(e,1);return}var t=this.childrens.indexOf(e);if(t!==-1){e.killMePlease(),this.childrens[t]=null,this.childrens.splice(t,1);return}},o.prototype.onMouseDown=undefined,o.prototype.onMouseUp=undefined,o.prototype.onMouseMove=undefined,o.prototype.onMouseEnter=undefined,o.prototype.onMouseLeave=undefined,o.prototype.askToKill=function(){this.disable=!0,this.flag="delete",this.trigger("kill",this)},o.prototype.onKill=!1,o.prototype.killMePlease=function(){this.onKill&&this.onKill(),this.trigger("killed",this);for(var e=0;e<this.renderers.length;++e)delete this.renderers[e],this.renderers.splice(e,1);delete this.collider;for(e=0;e<this.childrens.length;++e)this.childrens[e].killMePlease(),delete this.childrens[e],this.childrens.splice(e,1)},o.prototype.render=t,o.prototype.update=n,o.prototype.addAutomatism=function(e,t){if(!this[t.type])return r.debug.log("%cCouldn't found the method "+t.type+" in GameObject prototype",1,"color:red"),!1;t.interval&&(t.lastCall=Date.now()),t.value1=t.value1||
undefined,t.value2=t.value2||undefined,t.persistant=t.persistant!=0?!0:!1,this.automatism[e]=t},o.prototype.removeAutomatism=function(e){if(!this.automatism[e]){r.debug.log("%c[RemoveAutomatism] Automatism "+e+" not found",1,"color:orange");return}delete this.automatism[e]},o.prototype.removeAutomatisms=function(){for(var e in this.automatism)delete this.automatism[e]},s.addEventCapabilities(o),o.prototype.DEName="GameObject",r.debug.log("GameObject loaded",3),o}),define("DE.Notifications",[],function(){var e=new function(){this.DEName="Notifications",this.notifs={},this.heightNotifs=0,this.selector="notifsContainer",this.el=null,this.templateName="notificationTemplate",this.template=null,this.defaultExpirationTime=3500,this.inited=!1;var e=this;this.init=function(e){if(this.inited)return;e=e||{},e.notifications=e.notifications||{},this.selector=e.notifications.selector||this.selector,this.templateName=e.notifications.templateName||this.templateName,this.el=document.getElementById(this.
selector),this.template=document.getElementById(this.templateName).innerHTML;if(!this.el||!this.template)throw new Error("FATAL ERROR: Can't init Notifications without an element AND a template -- selector:: "+this.selector+" -- templateName:: "+this.templateName);this.inited=!0,document.body.removeChild(document.getElementById(this.templateName))},this.create=function(t,n){if(!this.inited)return;this.heightNotifs=this.heightNotifs<0?0:this.heightNotifs,n=n||{};var r=n.expire||this.defaultExpirationTime,i=Date.now()+"-"+(Math.random()*100>>0),s=document.createElement("div");s.innerHTML=this.template,s.getElementsByClassName("content")[0].innerHTML=t,s.id="notif"+i,this.el.appendChild(s),this.notifs[i]=s,this.notifs[i].getElementsByClassName("notifClose")[0].addEventListener("click",function(){e.remove(i,!0)});var o=this.notifs[i].offsetHeight;this.heightNotifs+=o,this.el.style.height=this.heightNotifs+"px",this.bindRemove(i,r)},this.bindRemove=function(t,n){n=n||this.defaultExpirationTime
,setTimeout(function(){e.remove(t)},n)},this.remove=function(t,n){if(!this.notifs[t])return;if(n){var r=this.el.offsetHeight-this.notifs[t].offsetHeight;this.el.style.height=r+"px",this.el.removeChild(this.notifs[t]),delete this.notifs[t];return}var i=this.notifs[t].offsetHeight;this.notifs[t].className=this.notifs[t].className+" disapear",e.heightNotifs-=i,e.el.style.height=e.heightNotifs+"px",setTimeout(function(){e.el.removeChild(e.notifs[t]),delete e.notifs[t]},110)}};return e}),define("DE.LangSystem",["DE.CONFIG"],function(e){var t=new function(){this.DEName="LangSystem",this.currentLang="en",this.dictionary={},this.avalaibleLang=new Array,this.init=function(e){for(var t in e)this.dictionary[t]=e[t],this.avalaibleLang.push(t)},this.get=function(e){return this.dictionary[this.currentLang][e]||null},this.forceGet=function(e,t){return this.avalaibleLang.indexOf(e)==-1?null:this.dictionary[e][t]||null},this.getLang=function(e){this.currentLang=this.avalaibleLang[0],e||(e=navigator.language||
navigator.browserLanguage||"en");for(var t in this.dictionary)if(e.match(t)){this.currentLang=t;break}}};return e.debug.log("LangSystem loaded",3),t}),define("DE.GamePad",["DE.CONFIG","DE.Event","DE.Notifications","DE.LangSystem"],function(e,t,n,r){var i=t.addEventCapabilities,s=function(e){var t=function(){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var e=new Number(RegExp.$1);return e}return!1},n=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("chrome")>-1&&e.indexOf("android")==-1&&e.indexOf("iphone")==-1&&e.indexOf("ipad")==-1&&e.indexOf("ipod")==-1},r={firefox:t,chrome:n};return r[e]()},o={},u=new function(){function u(e){l[e.gamepad.index]=e.gamepad,l.length++}this.DEName="GamePad";var a={},f={},l={};this.gamePadsInfos={};var c={},h=function(){},p=function(){};this.init=function(){s("chrome")?(e.notifications.gamepadEnable&&n.create(r.get("gamepadAvalaible")||e.notifications.gamepadAvalaible),h=function(e){var t=navigator.webkitGetGamepads&&navigator
.webkitGetGamepads()||[];for(var n=0;n<t.length;++n)if(t[n]){if(!c[n]||c[n]!=t[n].timestamp)c[n]=t[n].timestamp,this.handleGamePad(t[n],e)}else this.disconnectGamePad(n)},p=function(e){var t=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||[];for(var n=0;n<t.length;++n){var r=t[n];if(r){this.handleGamePad(r,e);continue}this.disconnectGamePad(n)}},this.updateByChange()):s("firefox")};var d=function(e){var t=["leftThumbX","leftThumbY","rightThumbX","rightThumbY"],n=["a","b","y","x","left_shoulder","right_shoulder","LeftTrigger","RightTrigger","back","start","left_thumb","right_thumb","dpad_up","dpad_down","dpad_left","dpad_right"],r={};r.index=e.controllerId,r.timestamp=e.packetNumber,r.buttons=[],r.axes=[];for(var i=0;i<n.length;++i){var s=n[i];if(s=="LeftTrigger"||s=="RightTrigger"){r.buttons[i]=e[s]/255;continue}if(e[s]){r.buttons[i]=1;continue}r.buttons[i]=0}for(var i=0;i<t.length;++i){var s=t[i];r.axes[i]=e[s]/32767;if(s=="leftThumbY"||s=="rightThumbY")r.axes[i]*=-1}return r
};this.windowsControllers=[],this.adaptToWindowsLib=function(e,t){var n=t||4;e||console.error("gamepad::adaptToWindowsLib - windowsGamepadLib is null");for(var r=0;r<n;++r)this.windowsControllers[r]=new e.Controller(r);h=function(e){var t=this.windowsControllers;for(var n=0;n<t.length;++n){var r=t[n];if(r){r=r.getState();if(r.connected){if(!c[n]||c[n]!=r.packetNumber){c[n]=r.packetNumber;var i=d(r);this.handleGamePad(i,e)}continue}this.disconnectGamePad(n)}}},p=function(e){var t=this.windowsControllers;for(var n=0;n<t.length;++n){var r=t[n];if(r){r=r.getState();if(r.connected){var i=d(r);this.handleGamePad(i,e);continue}this.disconnectGamePad(n)}}},this.update=p,this.handleDown=w},window.addEventListener("MozGamepadConnected",u,!1),this.connectToGameLoop=function(e){e.addNonStop("gamePad",this)},this.handleGamePad=function(i,s){var u=i.index;this.gamePadsInfos[u]=i,a[u]&&this.handleListeners(u,i.buttons,a,s),f[u]&&this.handleListeners(u,i.axes,f,s),o[u]||(e.debug.log("Gamepad connected "+
u,2),e.notifications.gamepadChange&&(this.isGamepadConnected=!0,n.create(r.get("onGamepadConnect")||"Gamepad "+(u+1)+" connected")),t.emit("connectGamepad",u),o[u]=!0)},this.disconnectGamePad=function(i){c[i]=null,l[i]=null,this.gamePadsInfos[i]=null;if(o[i]){e.debug.log("Disconnect gamepad "+i,2);if(e.notifications.gamepadChange){this.isGamepadConnected=!1;for(var s in o)if(o[s]){this.isGamepadConnected=!0;break}n.create(r.get("onGamepadDisconnect")||"Gamepad "+(i+1)+" disconnected")}t.emit("disconnectGamepad",i),o[i]=!1}};var v=.5,m=function(e){return e<-v&&e<0||e>v&&e>0?!0:!1},g=function(e,t,n,r){m(r)&&!n.active&&(t.emit("down"+e,r,e),n.active=!0)},y=500,b=150,w=function(e,t,n,r,i){if(m(r)){if(!n.active)return t.emit("down"+e,r,e),n.active=!0,n.timesTamp=i,n.diffTime=y,!0;if(n.noRate)return!0;if(n.timesTamp+n.diffTime<i)return t.emit("down"+e,r,e),n.timesTamp=i,n.diffTime=b,!0}return!1},E=function(e,t,n,r){for(var i in n[e].listeners){var s=t[i],o=n[e],u=n[e].listeners[i];if(s<.3&&s>0||
s>-0.3&&s<0)s=0;s!=u.force&&o.emit("move"+i,s,i),u.force=s;if(this.handleDown(i,o,u,s,r))continue;!m(s)&&u.active&&(o.emit("up"+i,s,i),u.active=!1,u.count=0)}};this.handleListeners=E,this.handleGamePadAxes=function(e){for(var t in f[e.index].listeners)if(e.axes[t]>0&&!f[e.index].listeners[t]){a[e.index].emit("down"+t),a[e.index].listeners[t]=!0;continue}};var S=function(e,t,n){e[t]||(e[t]={},e[t].listeners={},i(e[t])),typeof e[t].listeners[n]=="undefined"&&(e[t].listeners[n]={active:!0,force:0})},x=function(e,t,n,r,i,s){S(e,t,n),e[t].on(r+n,i),e[t].listeners[n].noRate=s},T=function(e,t,n,r){e[t]&&e[t].del(r+n)},N=function(e,t,n){if(!e[t])return;T(e,t,n,"down"),T(e,t,n,"up"),T(e,t,n,"move"),delete e[t].listeners[n]},C=function(e,t){if(!e[t])return;for(var n in e[t].listeners)N(e,t,n)},k=function(e){if(!e)return;for(var t in e)C(e,t)};this.onBtnDown=function(e,t,n,r){x(a,e,t,"down",n,r)},this.onBtnMove=function(e,t,n,r){x(a,e,t,"move",n,r)},this.onBtnUp=function(e,t,n,r){x(a,e,t,"up",n,r)
},this.delBtnDown=function(e,t){T(a,e,t,"down")},this.delBtnMove=function(e,t){T(a,e,t,"move")},this.delBtnUp=function(e,t){T(a,e,t,"up")},this.delBtn=function(e,t){N(a,e,t)},this.delBtnsPad=function(e){C(a,e)},this.delBtnsListeners=function(){k(a)},this.onAxeStart=function(e,t,n,r){x(f,e,t,"down",n,r)},this.onAxeMove=function(e,t,n,r){x(f,e,t,"move",n,r)},this.onAxeStop=function(e,t,n,r){x(f,e,t,"up",n,r)},this.delAxeStart=function(e,t){T(f,e,t,"down")},this.delAxeMove=function(e,t){T(f,e,t,"move")},this.delAxeStop=function(e,t){T(f,e,t,"up")},this.delAxe=function(e,t){N(f,e,t)},this.delAxesPad=function(e){C(f,e)},this.delAxesListeners=function(){k(f)},this.delListeners=function(){k(f),k(a)},this.plugBtnToInput=function(e,t,n,r){this.onBtnDown(n,r,function(n){e.usedInputs[t].isDown=!0,e.trigger("keyDown",t,n)},!1),this.onBtnUp(n,r,function(n){e.usedInputs[t].isDown=!1,e.trigger("keyUp",t,n)},!1),this.onBtnMove(n,r,function(n){e.trigger("btnMoved",t,n)},!1)},this.plugAxeToInput=function(
e,t,n,r){this.onAxeStart(n,r,function(n){e.trigger("axeStart",t,n)},!1),this.onAxeStop(n,r,function(n){e.trigger("axeStop",t,n)},!1),this.onAxeMove(n,r,function(n){e.trigger("axeMoved",t,n)},!1)},this.updateByRate=function(){this.update=p,this.handleDown=w},this.updateByChange=function(){this.update=h,this.handleDown=g},this.update=function(){}};return e.debug.log("gamepad loaded",3),u}),define("handjs",[],function(){var e=e||{};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var t=["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],n=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter"
,"PointerLeave"],r="touch",i="pen",s="mouse",o={},u=function(e){while(e&&!e.handjs_forcePreventDefault)e=e.parentNode;return!!e},a=function(e){return u(e)||u(window)},f=function(e,t,n){var o;document.createEvent?(o=document.createEvent("MouseEvents"),o.initMouseEvent(t,n,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,null)):(o=document.createEventObject(),o.screenX=e.screenX,o.screenY=e.screenY,o.clientX=e.clientX,o.clientY=e.clientY,o.ctrlKey=e.ctrlKey,o.altKey=e.altKey,o.shiftKey=e.shiftKey,o.metaKey=e.metaKey,o.button=e.button),o.offsetX===undefined&&(e.offsetX!==undefined?(Object&&Object.defineProperty!==undefined&&(Object.defineProperty(o,"offsetX",{writable:!0}),Object.defineProperty(o,"offsetY",{writable:!0})),o.offsetX=e.offsetX,o.offsetY=e.offsetY):e.layerX!==undefined&&(o.offsetX=e.layerX-e.currentTarget.offsetLeft,o.offsetY=e.layerY-e.currentTarget.offsetTop)),e.isPrimary!==undefined?o.isPrimary=e.isPrimary:o.isPrimary=!0;
if(e.pressure)o.pressure=e.pressure;else{var u=0;e.which!==undefined?u=e.which:e.button!==undefined&&(u=e.button),o.pressure=u==0?0:.5}e.rotation?o.rotation=e.rotation:o.rotation=0,e.hwTimestamp?o.hwTimestamp=e.hwTimestamp:o.hwTimestamp=0,e.tiltX?o.tiltX=e.tiltX:o.tiltX=0,e.tiltY?o.tiltY=e.tiltY:o.tiltY=0,e.height?o.height=e.height:o.height=0,e.width?o.width=e.width:o.width=0,o.preventDefault=function(){e.preventDefault!==undefined&&e.preventDefault()};if(o.stopPropagation!==undefined){var f=o.stopPropagation;o.stopPropagation=function(){e.stopPropagation!==undefined&&e.stopPropagation(),f.call(this)}}o.POINTER_TYPE_TOUCH=r,o.POINTER_TYPE_PEN=i,o.POINTER_TYPE_MOUSE=s,o.pointerId=e.pointerId,o.pointerType=e.pointerType;switch(o.pointerType){case 2:o.pointerType=o.POINTER_TYPE_TOUCH;break;case 3:o.pointerType=o.POINTER_TYPE_PEN;break;case 4:o.pointerType=o.POINTER_TYPE_MOUSE}e.currentTarget&&a(e.currentTarget)===!0&&o.preventDefault(),e.target?e.target.dispatchEvent(o):e.srcElement.fireEvent
("on"+m(t),o)},l=function(e,t){e.pointerId=1,e.pointerType=s,f(e,t,!1)},c=function(e,t,n,i){var s=t.identifier+2;t.pointerId=s,t.pointerType=r,t.currentTarget=n,t.target=n,i.preventDefault!==undefined&&(t.preventDefault=function(){i.preventDefault()}),f(t,e,!0)},h=function(e,t){while(e&&(!e.__handjsGlobalRegisteredEvents||!e.__handjsGlobalRegisteredEvents[t]))e=e.parentNode;return!!e},p=function(e,t){return h(e,t)||h(window,t)},d=function(e,t,n,r){p(n,e)&&c(e,t,n,r)},v=function(e,t,n,r){e.preventManipulation&&e.preventManipulation();for(var i=0;i<e.changedTouches.length;++i){var s=e.changedTouches[i];n&&(o[s.identifier]=s.target),r?d(t,s,o[s.identifier],e):c(t,s,o[s.identifier],e)}},m=function(e){return e.toLowerCase().replace("pointer","mouse")},g=function(e,r,i){var s=t.indexOf(i),o=r+n[s];return o===r+"PointerEnter"&&e["on"+r.toLowerCase()+"pointerenter"]===undefined&&(o=r+"PointerOver"),o===r+"PointerLeave"&&e["on"+r.toLowerCase()+"pointerleave"]===undefined&&(o=r+"PointerOut"),o},y=
function(e,t,n,r){e.__handjsRegisteredEvents===undefined&&(e.__handjsRegisteredEvents=[]);if(r){if(e.__handjsRegisteredEvents[t]!==undefined){e.__handjsRegisteredEvents[t]++;return}e.__handjsRegisteredEvents[t]=1,e.addEventListener(t,n,!1)}else{if(e.__handjsRegisteredEvents.indexOf(t)!==-1){e.__handjsRegisteredEvents[t]--;if(e.__handjsRegisteredEvents[t]!=0)return}e.removeEventListener(t,n),e.__handjsRegisteredEvents[t]=0}},b=function(e,t,n){if(e.onpointerdown!==undefined)return;if(e.onmspointerdown!==undefined){var r=g(e,"MS",t);y(e,r,function(e){f(e,t,!0)},n);return}if(e.ontouchstart!==undefined)switch(t){case"pointermove":y(e,"touchmove",function(e){v(e,t)},n);break;case"pointercancel":y(e,"touchcancel",function(e){v(e,t)},n);break;case"pointerdown":case"pointerup":case"pointerout":case"pointerover":case"pointerleave":case"pointerenter":e.__handjsGlobalRegisteredEvents||(e.__handjsGlobalRegisteredEvents=[]);if(n){if(e.__handjsGlobalRegisteredEvents[t]!==undefined){e.__handjsGlobalRegisteredEvents
[t]++;return}e.__handjsGlobalRegisteredEvents[t]=1}else e.__handjsGlobalRegisteredEvents[t]!==undefined&&(e.__handjsGlobalRegisteredEvents[t]--,e.__handjsGlobalRegisteredEvents[t]<0&&(e.__handjsGlobalRegisteredEvents[t]=0))}switch(t){case"pointerdown":y(e,"mousedown",function(e){l(e,t)},n);break;case"pointermove":y(e,"mousemove",function(e){l(e,t)},n);break;case"pointerup":y(e,"mouseup",function(e){l(e,t)},n);break;case"pointerover":y(e,"mouseover",function(e){l(e,t)},n);break;case"pointerout":y(e,"mouseout",function(e){l(e,t)},n);break;case"pointerenter":e.onmouseenter===undefined?y(e,"mouseover",function(e){l(e,t)},n):y(e,"mouseenter",function(e){l(e,t)},n);break;case"pointerleave":e.onmouseleave===undefined?y(e,"mouseout",function(e){l(e,t)},n):y(e,"mouseleave",function(e){l(e,t)},n)}},w=function(e){var n=e.prototype?e.prototype.addEventListener:e.addEventListener,r=function(e,r,i){t.indexOf(e)!=-1&&b(this,e,!0),n===undefined?this.attachEvent("on"+m(e),r):n.call(this,e,r,i)};e.prototype?
e.prototype.addEventListener=r:e.addEventListener=r},E=function(e){var n=e.prototype?e.prototype.removeEventListener:e.removeEventListener,r=function(e,r,i){t.indexOf(e)!=-1&&b(this,e,!1),n===undefined?this.detachEvent(m(e),r):n.call(this,e,r,i)};e.prototype?e.prototype.removeEventListener=r:e.removeEventListener=r};return w(window),w(HTMLElement),w(document),w(HTMLBodyElement),w(HTMLDivElement),w(HTMLImageElement),w(HTMLUListElement),w(HTMLAnchorElement),w(HTMLLIElement),w(HTMLTableElement),window.HTMLSpanElement&&w(HTMLSpanElement),window.HTMLCanvasElement&&w(HTMLCanvasElement),window.SVGElement&&w(SVGElement),E(window),E(HTMLElement),E(document),E(HTMLBodyElement),E(HTMLDivElement),E(HTMLImageElement),E(HTMLUListElement),E(HTMLAnchorElement),E(HTMLLIElement),E(HTMLTableElement),window.HTMLSpanElement&&E(HTMLSpanElement),window.HTMLCanvasElement&&E(HTMLCanvasElement),window.SVGElement&&E(SVGElement),window.ontouchstart!==undefined&&(window.addEventListener("touchstart",function(e){for(
var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];o[n.identifier]=n.target,d("pointerenter",n,n.target,e),d("pointerover",n,n.target,e),d("pointerdown",n,n.target,e)}}),window.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=o[n.identifier];d("pointerup",n,r,e),d("pointerout",n,r,e),d("pointerleave",n,r,e)}}),window.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=document.elementFromPoint(n.clientX,n.clientY),i=o[n.identifier];if(i===r)continue;i&&(d("pointerout",n,i,e),i.contains(r)||d("pointerleave",n,i,e)),r&&(d("pointerover",n,r,e),r.contains(i)||d("pointerenter",n,r,e)),o[n.identifier]=r}})),navigator.pointerEnabled===undefined&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(
e.doNotProcessCSS)return;var t=function(e){return e.replace(/^\s+|\s+$/,"")},n=function(e){var n=new RegExp(".+?{.*?}","m"),r=new RegExp(".+?{","m");while(e!=""){var i=n.exec(e);if(!i)break;var s=i[0];e=t(e.replace(s,""));var o=t(r.exec(s)[0].replace("{",""));if(s.replace(/\s/g,"").indexOf("touch-action:none")!=-1){var u=document.querySelectorAll(o);for(var a=0;a<u.length;a++){var f=u[a];f.style.msTouchAction!==undefined?f.style.msTouchAction="none":f.handjs_forcePreventDefault=!0}}}};try{for(var r=0;r<document.styleSheets.length;r++){var i=document.styleSheets[r];if(i.href==undefined)continue;var s=new XMLHttpRequest;s.open("get",i.href,!1),s.send();var o=s.responseText.replace(/(\n|\r)/g,"");n(o)}}catch(u){}var a=document.getElementsByTagName("style");for(var r=0;r<a.length;r++){var f=a[r],l=t(f.innerHTML.replace(/(\n|\r)/g,""));n(l)}},!1),""}),define("DE.Inputs",["DE.CONFIG","DE.GamePad","handjs"],function(e,t){var n=new function(){function r(e){return e.pointerId=e.pointerId||0,n.mouse
[e.pointerId]||(n.mouse[e.pointerId]={isDown:!1,x:0,y:0,index:e.pointerId}),n.mouse[e.pointerId].isDown=!0,n.mouse[e.pointerId].x=e.clientX,n.mouse[e.pointerId].y=e.clientY,n.mouse[e.pointerId]}this.DEName="Inputs",this.isListening=!1,this.usedInputs={};var i={};this.keyLocked=!1,this.mouse=[{x:0,y:0,isDown:!1,index:0}],this.dbInputs={MOUSE:{leftClick:1000000001,rightClick:1000000002,wheelTop:1000000003,wheelDown:1000000004},KEYBOARD:{up:38,down:40,left:37,right:39,space:32,shift:16,caps:20,tab:9,escape:27,d:68,q:81,z:90,s:83,a:65,e:69,r:82,t:84,y:89,u:85,i:73,o:79,p:80,f:70,g:71,h:72,j:74,k:75,l:76,m:77,w:87,x:88,c:67,v:86,b:66,n:78,enter:13,"return":8,"PAD+":107,"PAD-":109,"PAD*":106,"PAD/":111,PAD0:96,PAD1:97,PAD2:98,PAD3:99,PAD4:100,PAD5:101,PAD6:102,PAD7:103,PAD8:104,PAD9:105},GAMEPADBUTTONS:{A:0,B:1,Y:3,X:2,"D-Up":12,"D-Right":15,"D-Left":14,"D-Bot":13,select:8,start:9,RBS:7,RTS:5,LBS:6,LTS:4,power:16},GAMEPADAXES:{LHorizontal:0,LVertical:1,RHorizontal:2,RVertical:3}},this.queue={
keyDown:{},keyUp:{},mouseDown:{},mouseUp:{},btnMoved:{},axeMoved:{},axeStart:{},axeStop:{}},this.on=function(e,t,n){if(!this.queue[e][t]){console.log("%cWARN:: Try to bind on a non existant input ::: "+e+" - "+t,"color:red");return}this.queue[e][t].push(n)},this.init=function(e){var n={};for(var r in e){n[r]={},n[r].inputs=new Array;for(var i=0,s;s=e[r].keycodes[i];i++){var o=s[0]=="K"||s[0]=="k"?"KEYBOARD":"MOUSE",u=s.split("."),a=0,f;u[0][0]=="G"?(u[0][1]&&(a=parseInt(u[0][1])),u[1]=="A"?o="GAMEPADAXES":o="GAMEPADBUTTONS",f=u[2]):f=s.slice(2,s.length);if(typeof this.dbInputs[o][f]=="undefined"){console.log("%cAn input couldn't be found in the database, did you respect the caseSensitive ?:"+o+"."+f+"\n Ignoring it and continue...","color:red");continue}o=="GAMEPADBUTTONS"?t.plugBtnToInput(this,r,a,this.dbInputs[o][f]):o=="GAMEPADAXES"&&t.plugAxeToInput(this,r,a,this.dbInputs[o][f]),n[r].inputs.push({code:this.dbInputs[o][f],type:o})}n[r].interval=e[r].interval||0,n[r].lastCall=Date.now
(),n[r].actions={},n[r].isDown=!1,n[r].isLongPress=e[r].isLongPress||!1,n[r].stayOn=e[r].stayOn||!1,n[r].numberCall=0,n[r].numberPress=0,n[r].stayOn&&(n[r].lastCall=Date.now()+n[r].interval),this.queue.keyDown[r]=new Array,this.queue.keyUp[r]=new Array,this.queue.mouseDown[r]=new Array,this.queue.mouseUp[r]=new Array,this.queue.btnMoved[r]=new Array,this.queue.axeMoved[r]=new Array,this.queue.axeStart[r]=new Array,this.queue.axeStop[r]=new Array}this.usedInputs=n,this.toggleListeners()},this.get=function(e){return this.usedInputs[e]?this.usedInputs[e]:!1},this.trigger=function(e,t,r){if(n.keyLocked&&e.search("mouse")==-1)return;for(var i in n.queue[e][t])n.queue[e][t][i](r)},this.key=function(e){if(n.keyLocked)return;return this.usedInputs[e]&&this.usedInputs[e].isDown&&(!this.usedInputs[e].interval||Date.now()-this.usedInputs[e].lastCall>=this.usedInputs[e].interval)?(n.usedInputs[e].stayOn||(n.usedInputs[e].lastCall=Date.now()),n.usedInputs[e].numberCall++,!0):!1},this.toggleListeners=
function(e,t){var r=e||window;this.isListening&&!t?r.removeEventListener?(r.removeEventListener("keydown",n.keyDown,!1),r.removeEventListener("keyup",n.keyUp,!1),r.removeEventListener("keypress",n.keyPress,!1)):r.detachEvent&&(r.detachEvent("onkeydown",n.keyDown),r.detachEvent("onkeyup",n.keyUp),r.detachEvent("onkeypress",n.keyPress)):r.addEventListener?(r.addEventListener("keydown",n.keyDown,!1),r.addEventListener("keyup",n.keyUp,!1),r.addEventListener("keypress",n.keyPress,!1)):r.attachEvent&&(r.attachEvent("onkeydown",n.keyDown),r.attachEvent("onkeyup",n.keyUp),r.attachEvent("onkeypress",n.keyPress))},this.findInput=function(e,t){for(var r in n.usedInputs)for(var i in n.usedInputs[r].inputs){var s=n.usedInputs[r].inputs[i].code,o=n.usedInputs[r].inputs[i].type;if(s==e&&o==t)return r}return!1},this.keyDown=function(e){if(n.keyLocked)return!1;var t=e||window.event,r=t.which||t.keyCode,i=n.findInput(r,"KEYBOARD");i!==!1&&(!n.usedInputs[i].isDown&&Date.now()-n.usedInputs[i].lastCall>=n.usedInputs
[i].interval&&(n.usedInputs[i].isLongPress&&!n.usedInputs[i].stayOn&&(n.usedInputs[i].lastCall=Date.now()),n.usedInputs[i].isDown||n.trigger("keyDown",i,1),n.usedInputs[i].isDown=!0),n.usedInputs[i].numberPress++)},this.keyUp=function(e){if(n.keyLocked)return!1;var t=e||window.event,r=t.which||t.keyCode,i=n.findInput(r,"KEYBOARD");i!==!1&&(n.usedInputs[i].isDown&&n.trigger("keyUp",i),n.usedInputs[i].stayOn&&(n.usedInputs[i].lastCall=Date.now()),n.usedInputs[i].isDown=!1)},this.keyPress=function(e){var t=e||window.event,r=t.which||t.keyCode,i=t.keyCode,s=n.findInput(i,"KEYBOARD");s!==!1&&n.usedInputs[s].isDown},this.mouseDown=function(e){i[e.target.id]&&i[e.target.id].oOnMouseDown(r(e));var t=n.findInput(1000000001,"MOUSE");return t!==!1&&(n.usedInputs[t].isDown||n.trigger("mouseDown",t),n.usedInputs[t].isDown=!0),!1},this.mouseUp=function(e){i[e.target.id]&&i[e.target.id].oOnMouseUp(r(e));var t=n.findInput(1000000001,"MOUSE");return t!==!1&&(n.usedInputs[t].isDown&&n.trigger("mouseUp",t
),n.usedInputs[t].isDown=!1),e.preventDefault(),!1},this.mouseMove=function(e){return i[e.target.id]&&i[e.target.id].oOnMouseMove(r(e)),e.preventDefault(),!1},this.mouseClick=function(e){},this.mouseDbClick=function(){},this.rightClick=function(e){e.preventDefault(),e.stopPropagation()},this.addEvent=function(e){},this.addActionInput=function(t,n,r){if(!this.checkInputExist(n))return;e.DEBUG&&e.DEBUG_LEVEL>=3&&this.usedInputs[n].actions[r]&&e.debug.log("Replace the action "+r+" on input "+n,3)},this.removeActionInput=function(t,n){if(!this.checkInputExist(t))return;if(!this.usedInputs[t].actions[n])throw new Error("Try to remove a not founded action by id:: "+n);e.debug.log("Remove the action "+n+" on input "+t,3),delete this.usedInputs[t].actions[n]},this.checkInputExist=function(t){return this.usedInputs[t]?!0:(e.debug.log("Try to access an input not defined:: "+t,1),!1)},this.addRender=function(e){i[e.id]=e;var t=e.canvas;t.addEventListener("pointerdown",n.mouseDown,!1),t.addEventListener
("pointerup",n.mouseUp,!1),t.addEventListener("pointerout",n.mouseMove,!1),t.addEventListener("pointermove",n.mouseMove,!1),t.addEventListener("contextmenu",n.rightClick,!1),t.addEventListener("DOMMouseScroll",n.mouseWheel,!1),t.addEventListener("mousewheel",n.mouseWheel,!1),t.onmousewheel=n.mouseWheel,window.attachEvent&&t.attachEvent("onmousewheel",n.mouseWheel)},this.removeRender=function(t){if(!i[t].canvas){e.debug.log("[INPUTS] Try to remove a renders but not found :: "+t,1);return}i[t].canvas.removeEventListener("pointerdown",n.mouseDown,!1),i[t].canvas.removeEventListener("pointerup",n.mouseUp,!1),i[t].canvas.removeEventListener("pointerout",n.mouseUp,!1),i[t].canvas.removeEventListener("pointermove",n.mouseMove,!1),i[t].canvas.removeEventListener("contextmenu",n.rightClick,!1),i[t].canvas.removeEventListener("DOMMouseScroll",n.mouseWheel,!1),delete i[t]},this.mouseWheel=function(e){var t=e.wheelDelta>0?1:-1;e.detail&&(t=e.detail<0?1:-1),t==1?n.trigger("axeMoved","wheelTop"):n.trigger
("axeMoved","wheelDown")}};return e.debug.log("Inputs loaded",3),n}),define("DE.SystemDetection",["DE.CONFIG","DE.LangSystem"],function(e,t){var n=new function(){this.DEName="SystemDetection",this.touchPlatform=!1,this.init=function(e){ua=navigator.userAgent;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|tizen/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
.test(ua.substr(0,4)))this.touchPlatform=!0;t.getLang()},this.render=null,this.scene=null,this.camera=null,this.isOverridingMainLoop=!1,this.askToRateIf="playedOnce",this.askToRate=function(){},this.initSystem=function(e,t){if(e)for(var n in e)this[n]=e[n];this.init(t)}};return e.debug.log("SystemDetection loaded",3),n}),define("stash",[],function(){function e(e,t){return t!==undefined&&t!==null&&t.constructor===e}function t(e){return"'"+String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+"'"}function n(e){var t=l.createElement("_");return t.innerHTML=e,t.firstChild}function r(e){if(e.outerHTML)return e.outerHTML;var t=l.createElement("_");return t.appendChild(e.cloneNode(!0)),t.innerHTML}function i(n){var i=arguments.callee,s=[],o,u=-1,f;if(e(String,n))return t(n);if(n===undefined||n===null||e(Boolean,n)||e(Number,n)||e(RegExp,n)||e(Function,n)&&!/^function[^\{]+\{\s*\[native code\]/.test(String(n)))return String(n);if(e(Date
,n))return"new Date("+n.getTime()+")";if(e(Array,n)){o=n.length;while(++u<o)s.push(i(n[u]));return"["+s+"]"}if(e(Object,n)){for(f in n)s.push(t(f)+":"+i(n[f]));return"{"+s+"}"}if(n===a)return"window";for(f in a)if(n===a[f])return"window."+f;for(f in l)if(n===l[f])return"document."+f;if(n.nodeName)return"h("+t(r(n))+")"}function s(e){return(new Function("var a=arguments;h=a[0];return "+e)).apply(a,[n])}function o(){var t={},n=arguments,r=n.length,i=-1,s;while(++i<r)if(e(Object,n[i]))for(s in n[i])t[s]=e(Object,t[s])&&e(Object,n[i][s])?n.callee(t[s],n[i][s]):n[i][s];return t}function u(t,n,r){var u=f[t],a;if(r){a=s(u);if(e(Array,a))n=a.concat(n);else if(e(Boolean,a))n=a&&!!n;else if(e(Date,a)&&!isNaN(n*1))n=new Date(a.getTime()+n*1);else if(e(Function,a)&&e(Function,n))n=new Function("return("+String(a)+").apply(this, arguments)&&("+String(n)+").apply(this, arguments)");else if(e(Number,a)&&!isNaN(n*1))n=a+n*1;else if(e(Object,a)&&e(Object,n))n=o(a,n);else if(e(RegExp,a)&&e(RegExp,n)){var l=/^\/([\W\w]*)\/([a-z]*?)$/
,c=String(a).match(l),h=String(n).match(l);n=new RegExp(c[1]+h[1],c[2]+h[2])}else{if(!e(String,a))return 2;n=a+String(n)}}return n=i(n),u===n?2:(f[t]=n)&&1}var a=window,f=window.document.localStorage||window.localStorage,l=document,c={has:function(){var e=[].concat.apply([],arguments),t,n=-1;while(t=e[++n])if(f[t]===undefined)return!1;return!0},get:function(e){var t=[].concat.apply([],arguments),n,r=-1,i={};if(t.length===1)return s(f[e]);while(n=t[++r])i[n]=s(f[n]);return i},getAll:function(){var e,t={};for(e in f)t[e]=f[e];return t},set:function(t,n){var r=[].concat.apply([],arguments),i,s=-1,o,a=2;if(e(String,t))return u(t,n);while(i=r[++s])for(o in i)a=Math.min(a,u(o,i[o]));return a},add:function(t,n){var r=[].concat.apply([],arguments),i,s=-1,o,a=2;if(e(String,t))return u(t,n,!0);while(i=r[++s])for(o in i)a=Math.min(a,u(o,i[o],!0));return a},cut:function(e){var t=[].concat.apply([],arguments),n,r=-1;while(n=t[++r])delete f[n];return!0},cutAll:function(){for(var e in f)delete f[e];return!0
}};return c}),define("DE.about",["DE.CONFIG"],function(e){var t={};return t.DEName="about",t.version="0.1.0",t.gameName="DreamGame",t.gameVersion="0.1.0",t.gameAuthor="Dreamirl",t.set=function(e){e=e||{},t.gameName=e.gameName||t.gameName,t.gameVersion=e.gameVersion||t.gameVersion,t.gameAuthor=e.gameAuthor||t.gameAuthor},e.debug.log("about loaded",3),t}),define("DE.SaveSystem",["stash","DE.CONFIG","DE.about"],function(e,t,n){var r=new function(){this.DEName="SaveSystem",this.saveModel={},this.namespace="DreamGame",this.init=function(t,r){t=t||{},t.settings||(t.settings={}),this.namespace=n.gameName,this.version=n.version,r&&(this.version=e.get(this.namespace)),this.saveModel=t;for(var i in this.saveModel)this.saveModel[i]=e.get(this.namespace+this.version+i)||this.saveModel[i],e.cut(this.namespace+this.version+i);this.version=n.version,e.set(this.namespace,this.version);for(var i in this.saveModel)e.set(this.namespace+this.version+i,this.saveModel[i])},this.get=function(t){return t in this
.saveModel||(this.saveModel[t]=e.get(this.namespace+this.version+t)),this.saveModel[t]},this.save=function(n,r){n in this.saveModel||t.debug.log("%c[WARN] You save a key doesn't exist in your saveModel ! add it to your saveModel but engine wont be able to get it later",0,"color:orange"),e.set(this.namespace+this.version+n,r),this.saveModel[n]=r},this.saveAll=function(){for(var t in this.saveModel)e.set(this.gameName+this.version+t,this.saveModel[t])}};return t.debug.log("SaveSystem loaded",3),r}),define("DE.Screen",["DE.CONFIG","DE.SaveSystem","DE.Event"],function(e,t,n){var r=new function(){this.DEName="Screen",this.screenSizes={},this.conceptionSizeIndex=0,this.ratioToConception=1,this.currentSizeIndex=0,this.screenSize={w:0,h:0},this.screenSizeRatio={w:0,h:0},this.dpi=1,this.init=function(e){e||console.log("%cFATAL ERROR %cyou need to pass the file containing all images datas when call DreamEngine.init","color:red;background:black","color: red"),this.screenSizes=e.screenSizes||[{w:1920
,h:1080,path:""}],this.conceptionSizeIndex=e.conceptionSizeIndex||0},this.udpateScreenSizes=function(r){this.dpi=1;var i=i||1;i&&(this.dpi=i);var s=t.get("settings").quality||undefined,o=this.screenSizes;this.currentSizeIndex=0,this.screenSize.w=window.innerWidth||document.documentElement.clientWidth,this.screenSize.h=window.innerHeight||document.documentElement.clientHeight,this.screenSizeRatio.w=(window.innerWidth||document.documentElement.clientWidth)/this.dpi>>0,this.screenSizeRatio.h=(window.innerHeight||document.documentElement.clientHeight)/this.dpi>>0;if(o[r]||!isNaN(s)&&o[s])o[r]?(this.currentSizeIndex=r,t.get("settings").quality=r,t.save("settings",t.get("settings"))):this.currentSizeIndex=s||r;else{var u=0;for(var a=0;a<o.length;++a){this.currentSizeIndex=a;if(o[a].w<=this.screenSize.w&&o[a].h<=this.screenSize.h){if(a>0){var f=Math.abs(o[a].w-this.screenSize.w),l=Math.abs(o[a].h-this.screenSize.h),c=Math.abs(o[a-1].w-this.screenSize.w),h=Math.abs(o[a-1].h-this.screenSize.h);c<
f&&h<l&&(this.currentSizeIndex=a-1)}break}}t.get("settings").quality=r,t.save("settings",t.get("settings"))}e.debug.log("Choosen screen size index is "+this.currentSizeIndex+" - screenSize: "+JSON.stringify(this.screenSize)+" - choosedSize: "+JSON.stringify(o[this.currentSizeIndex])+" - dpi: "+this.dpi,2),this.ratioToConception=o[this.currentSizeIndex].w/o[this.conceptionSizeIndex].w,e.debug.log("Physical ratio is :: "+this.ratioToConception,2),n.emit("udpateScreenSizes",this.ratioToConception,o[this.currentSizeIndex])}};return e.debug.log("Screens loaded",3),r}),define("DE.MainLoop",["DE.Time","DE.CONFIG","DE.States","DE.Inputs","DE.GamePad","DE.SystemDetection","DE.Screen","DE.Event"],function(e,t,n,r,i,s,o,u){var a=new function(){this.DEName="MainLoop",this.launched=!1,this.renders=new Array,this.scenes=new Array,this.maxRenders=1,this.loader=null,this.loop=function(){if(!a.launched)return;requestAnimationFrame(a.loop);if(!e.update())return;if(n.get("isLoading")){if(!a.loader)return;
for(var t=0,r;r=a.renders[t];t++)r.ctx.translate(r.sizes.width*.5,r.sizes.height*.5),a.loader.render(r.ctx,1,1),r.ctx.translate(-r.sizes.width*.5,-r.sizes.height*.5);return}if(s.isOverridingMainLoop){if(!s.render)return;s.render.render(),s.scene.update(e.currentTime)}else if(n.get("isReady")){for(var t=0,r;r=a.renders[t];t++)r.render();while(e.missedFrame>=0){i.update(e.currentTime),a.customLoop(e.currentTime);for(var t=0,r;r=a.scenes[t];t++)!r.freeze&&!r.sleep&&r.update();--e.missedFrame}}},this.addRender=function(e){e.id=this.maxRenders++,this.renders.push(e),e.fullScreenMode=="ratioStretch"&&e.screenChangedSizeIndex(o.ratioToConception,o.screenSizes[o.currentSizeIndex])},this.screenChangedSizeIndex=function(e,t){for(var n=0,r;r=this.renders[n];++n)r.screenChangedSizeIndex(e,t)},this.addScene=function(e){this.scenes.push(e)},this.customLoop=function(e){}};return t.debug.log("MainLoop loaded",3),a}),define("DE.Scene",["DE.CONFIG","DE.COLORS","DE.GameObject","DE.Time","DE.MainLoop","DE.Event"
],function(e,t,n,r,i,s){function o(t){this.name=t||"NoName-"+(Date.now()+Math.random()*Date.now()>>0),this.gameObjects=new Array,this.sleep=!1,this.maxObjects=0,this.tickers=new Array,this.init=function(){i.addScene(this)},this.update=function(){if(this.sleep)return;for(var e=0,t=this.gameObjects.length,n;e<t;++e){n=this.gameObjects[e];if(!n)continue;if(n.flag!==null)switch(n.flag){case"delete":this.delete(e),--t;continue}n.update(r.currentTime)}for(var e=0,t=this.tickers.length;e<t;++tk)this.tickers[e].update();this.waitSortGameObjects&&this.sortGameObjects()},this.getGameObjects=function(){return this.gameObjects},this.sortGameObjects=function(){this.gameObjects.sort(function(e,t){return t.position.z==e.position.z?e.zindex-t.zindex:t.position.z-e.position.z});for(var e=0,t;t=this.gameObjects[e];e++)t.childrens.sort(function(e,t){return t.position.z==e.position.z?e.zindex-t.zindex:t.position.z-e.position.z});this.waitSortGameObjects=!1},this.add=function(t){if(!(t instanceof n)){e.debug
.log("%cIt's not or not herits from a GameObjects",1,"color:red");return}this.gameObjects.push(t),t.scene=this,++this.maxObjects,this.waitSortGameObjects=!0},s.addEventComponents(this),this.init()}return o.prototype=o.prototype||{},s.addEventCapabilities(o),o.prototype.remove=function(t){if(this.gameObjects[t])this.gameObjects.splice(t,1);else{var n=this.gameObjects.indexOf(t);if(n==-1){e.debug.log("%cRemove gameObject not found",1,"color:orange",t);return}this.gameObjects.splice(n,1)}this.maxObjects--},o.prototype.delete=function(e){this.gameObjects[e]?this.gameObjects[e].killMePlease():e.killMePlease(),this.remove(e)},o.prototype.deleteAll=function(){var e=this.gameObjects;while(e.length>0)this.delete(0);this.maxObjects=0},o.prototype.DEName="Scene",e.debug.log("Scene loaded",3),o}),define("DE.Rigidbody",["DE.Vector2","DE.CONFIG"],function(e,t){function n(t,n){n=n||{},this.gameObject=t,this.velocity=n.velocity||new e(n.initialVelocityX||0,n.initialVelocityY||0),this.mass=n.mass||0,this
.isKinetic=!1,this.isTrigger=!1,this.addForce=function(){},this.addForceTo=function(){}}return n.prototype=n.prototype||{},n.prototype.update=function(){},n.prototype.DEName="Rigidbody",t.debug.log("Rigidbody loaded",3),n}),define("DE.FixedBoxCollider",["DE.Collider","DE.COLORS","DE.CONFIG","DE.CanvasBuffer"],function(e,t,n,r){function i(i,s,o){o=o||{},o.type=n.COLLISION_TYPE.FIXED_BOX,e.call(this,o);var u=new Array,a=new Array,f=new Array;this.width=i||1,this.height=s||1,this.localPosition.x-=this.width*.5,this.localPosition.y-=this.height*.5,this.createDebugRenderer=function(){this.debugBuffer=new r(this.width,this.height),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=t.DEBUG.COLLIDER,this.debugBuffer.ctx.strokeRect(0,0,this.width,this.height)},this.getColliderPoints=function(){var e=this.gameObject.getPos();return{top:e.y+this.localPosition.y,left:e.x+this.localPosition.x,right:e.x+this.localPosition.x+this.width,bottom:e.y+this.localPosition.y+this.height}},n.DEBUG_LEVEL>1&&
this.createDebugRenderer()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="FixedBoxCollider",n.debug.log("FixedBoxCollider loaded",3),i}),define("DE.OrientedBoxCollider",["DE.Collider","DE.CONFIG","DE.CanvasBuffer","DE.COLORS"],function(e,t,n,r){function i(i,s,o){o=o||{},o.type=t.COLLISION_TYPE.ORIENTED_BOX,e.call(this,o);var u=new Array,a=new Array,f={x:this.localPosition.x,y:this.localPosition.y,radius:undefined};this.width=i||1,this.height=s||1;var l=-this.width*.5,c=this.width*.5,h=-this.height*.5,p=this.height*.5;this.init=function(){u.push({x:l,y:h}),u.push({x:l,y:p}),u.push({x:c,y:p}),u.push({x:c,y:h});for(var e=0,n;n=u[e];e++)n.ox=n.x,n.oy=n.y;var r=this.localPosition.x-(this.localPosition.x+u[0].x);r*=r;var i=this.localPosition.y-(this.localPosition.y+u[0].y);i*=i,f.radius=Math.sqrt(r+i);var s=this.width*.5;a.push({x:0,y:0,radius:s,isColliding:!1}),this.height<this.width&&(s=this.height*.5,a[0]={x:0,y:0,radius:s,isColliding:!1
});var o=(this.width-s*2)/(s*2)/2,d=!0;o<=0&&(o=(this.height-s*2)/(s*2)/2,d=!1);if(o>0){o>>=0,o++;while(o>0)d?(a.push({x:-s+l+s*2*o,y:0,radius:s,isColliding:!1}),a.push({x:s-l-s*2*o,y:0,radius:s,isColliding:!1})):(a.push({x:0,y:-s+h+s*2*o,radius:s,isColliding:!1}),a.push({x:0,y:s-h-s*2*o,radius:s,isColliding:!1})),o--}t.DEBUG_LEVEL>1&&this.createDebugRenderer()},this.createDebugRenderer=function(){this.debugBuffer=new n(f.radius,f.radius),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=r.DEBUG.COLLIDER,this.debugBuffer.ctx.strokeRect(0,0,this.width,this.height),this.debugBuffer.ctx.strokeStyle="blue",this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this.localPosition.x,this.localPosition.y,f.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath();for(var e=0,t;t=a[e];e++)this.debugBuffer.ctx.strokeStyle="blue",this.isColliding&&(this.debugBuffer.ctx.strokeStyle="green"),this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this
.localPosition.x+t.x,this.localPosition.y+t.y,t.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath();for(var e=0,i;i=u[e];e++)this.debugBuffer.ctx.strokeStyle="red",this.debugBuffer.ctx.fillRect(i.x-1,i.y-1,2,2)},this.debugRender=function(e){e.rotate(-this.gameObject.position.rotation),e.drawImage(this.debugBuffer.canvas,this.localPosition.x-this.debugBuffer.canvas.width*.5>>0,this.localPosition.y-this.debugBuffer.canvas.height*.5>>0),e.rotate(this.gameObject.position.rotation)},this.getExternCircle=function(){return f},this.getInternCircles=function(){return a},this.init()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="OrientedBoxCollider",t.debug.log("OrientedBoxCollider loaded",3),i}),define("DE.CircleCollider",["DE.Collider","DE.CONFIG","DE.CanvasBuffer","DE.COLORS"],function(e,t,n,r){function i(i,s){s=s||{},s.type=t.COLLISION_TYPE.CIRCLE,e.call(this,s),this.radius=i||1,this.createDebugRenderer=function(
){this.debugBuffer=new n(this.radius*2,this.radius*2),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=r.DEBUG.CIRCLE_COLLIDER,this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this.radius,this.radius,this.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath()},this.debugRender=function(e,t,n){if(!this.debugBuffer)return;e.drawImage(this.debugBuffer.canvas,this.localPosition.x-this.debugBuffer.canvas.width*.5*t*n>>0,this.localPosition.y-this.debugBuffer.canvas.height*.5*t*n>>0,this.debugBuffer.canvas.width*t*n>>0,this.debugBuffer.canvas.height*t*n>>0)},t.DEBUG_LEVEL>1&&this.createDebugRenderer()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="CircleCollider",t.debug.log("CircleCollider loaded",3),i}),define("DE.BoxRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.globalAlpha=this.alpha;switch(this.method){case"fill":this.fillIt(e,t,n);break;case"fillAndStroke"
:this.fillIt(e,t,n),this.strokeIt(e,t,n);break;case"stroke":this.strokeIt(e,t,n);break;default:this.strokeIt(e,t,n)}e.globalAlpha=r}return e.debug.log("BoxRenderer.render loaded",3),t}),define("DE.BoxRenderer",["DE.Renderer","DE.BoxRenderer.render","DE.CONFIG","DE.Sizes"],function(e,t,n,r){function i(t,n,i){e.call(this,t),this.sizes=new r(n,i,1,1),this.localPosition.x-=n*.5,this.localPosition.y-=i*.5,this.fillIt=function(e,t,n){e.fillStyle=this.fillColor,e.fillRect(this.localPosition.x*t>>0,this.localPosition.y*t>>0,this.sizes.width*t*n>>0,this.sizes.height*t*n>>0)},this.strokeIt=function(e,t,n){e.strokeStyle=this.strokeColor,e.strokeRect(this.localPosition.x*t>>0,this.localPosition.y*t>>0,this.sizes.width*t*n>>0,this.sizes.height*t*n>>0)},this.changeWidth=function(e){var t=e-this.sizes.width;this.sizes.width=e,this.localPosition.x-=t*.5>>0},this.changeHeight=function(e){var t=e-this.sizes.height;this.sizes.height=e,this.localPosition.y-=t*.5>>0},this.changeSizes=function(e,t){var n=e-this
.sizes.width;this.sizes.width=e;var r=t-this.sizes.height;this.sizes.height=t,this.localPosition.x-=n*.5>>0,this.localPosition.y-=r*.5>>0}}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="BoxRenderer",i.prototype.render=t,n.debug.log("BoxRenderer loaded",3),i}),define("DE.CircleRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.drawImage(this.buffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.radius*2*t*n>>0,this.radius*2*t*n>>0),e.globalAlpha=r}return e.debug.log("CircleRenderer.render loaded",3),t}),define("DE.CircleRenderer",["DE.Renderer","DE.CircleRenderer.render","DE.CONFIG","DE.CanvasBuffer"],function(e,t,n,r){function i(t,n,i,s,o){e.call(this,t),this.radius=n||1,this.angleStart=i||0,this.angleEnd=s||Math.PI*2,this.clockRotation=o||!1,this.buffer=null,this.localPosition.x-=this.radius,this.localPosition.y-=this.radius,this.initCircle=function(){this.buffer=new r(this.radius*2
,this.radius*2);var e=this.buffer.ctx;e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor,e.globalAlpha=this.alpha,e.beginPath(),e.arc(this.radius,this.radius,this.radius,this.angleStart,this.angleEnd,this.clockRotation);switch(this.method){case"fill":e.fill();break;case"fillAndStroke":e.fill(),e.stroke();break;case"stroke":e.stroke();break;default:e.stroke()}e.closePath()},this.initCircle()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="CircleRenderer",i.prototype.render=t,n.debug.log("CircleRenderer loaded",3),i}),define("DE.SpriteRenderer.render",["DE.ImageManager","DE.CONFIG","DE.Time"],function(e,t,n){function r(t,r,i){if(this.isAnimated&&!this.isPaused&&!this.isOver&&n.currentTime-this.lastAnim>this.eachAnim){var s=(n.currentTime-this.lastAnim)/this.eachAnim>>0;this.lastAnim=n.currentTime;while(s>0)this.isReversed?!this.isLoop&&this.currentFrame-1<this.startFrame?(this.isOver=!0,this.onAnimEnd()):this.currentFrame=this.currentFrame-1<
this.startFrame?this.endFrame-1:this.currentFrame-1:!this.isLoop&&this.currentFrame+1>=this.endFrame?(this.isOver=!0,this.onAnimEnd()):this.currentFrame=this.currentFrame+1>=this.endFrame?this.startFrame:this.currentFrame+1,s--}t.globalAlpha=this.alpha,t.drawImage(e.images[this.spriteName],this.frameSizes.width*this.currentFrame,this.frameSizes.height*this.currentLine,this.frameSizes.width,this.frameSizes.height,this.localPosition.x*i>>0,this.localPosition.y*i>>0,this.sizes.width*this.sizes.scaleX*i>>0,this.sizes.height*this.sizes.scaleY*i>>0),t.globalAlpha=1}return t.debug.log("SpriteRender.render loaded",3),r}),define("DE.SpriteRenderer",["DE.Renderer","DE.ImageManager","DE.Sizes","DE.SpriteRenderer.render","DE.CONFIG","DE.Time","DE.Event"],function(e,t,n,r,i,s,o){function u(r){if(!r)throw new Error("SpriteRenderer :: You have to pass arguments object to instantiate -- see the doc");e.call(this,r),this.spriteName=r.spriteName||undefined;if(!this.spriteName)throw new Error("SpriteRenderer :: No spriteName defined -- declaration canceled"
);if(!t.images[this.spriteName])throw new Error("SpriteRenderer :: Can't find image "+this.spriteName+" in imagesDatas");this.startFrame=r.startFrame||0,this.endFrame=r.endFrame||t.images[this.spriteName].totalFrame||0,this.totalFrame=t.images[this.spriteName].totalFrame||0,this.totalLine=r.totalLine||t.images[this.spriteName].totalLine||0,this.eachAnim=r.eachAnim||t.images[this.spriteName].eachAnim||0,this.lastAnim=Date.now(),this.frameSizes=new n(t.images[this.spriteName].widthFrame,t.images[this.spriteName].heightFrame,1,1),r.scaleX=r.scale||r.scaleX||r.scalex||1,r.scaleY=r.scale||r.scaleY||r.scaley||1,this.sizes=new n(r.width||r.w||t.images[this.spriteName].widthFrame,r.height||r.h||t.images[this.spriteName].heightFrame,r.scaleX,r.scaleY),this.isAnimated=r.isAnimated||t.images[this.spriteName].isAnimated,this.isPaused=r.paused||r.isPaused,t.images[this.spriteName].isPaused||!1,this.isReversed=r.reversed||r.isreversed||r.isReversed||t.images[this.spriteName].isReversed||!1,this.isOver=!1
,this.isLoop=r.isLoop!=undefined?r.isLoop:t.images[this.spriteName].isLoop,this.currentFrame=this.startFrame||0,this.currentLine=r.startLine||0,this.localPosition.x-=this.sizes.width*this.sizes.scaleX*.5>>0,this.localPosition.y-=this.sizes.height*this.sizes.scaleY*.5>>0,this.onAnimEnd=function(){},o.on("imageLoaded",function(e,n,r){if(r!=this.spriteName)return;this.localPosition.x+=this.sizes.width*this.sizes.scaleX*.5>>0,this.localPosition.y+=this.sizes.height*this.sizes.scaleY*.5>>0,this.frameSizes.width=t.images[this.spriteName].widthFrame,this.frameSizes.height=t.images[this.spriteName].heightFrame,this.sizes.width=this.frameSizes.width,this.sizes.height=this.frameSizes.height,this.localPosition.x-=this.sizes.width*this.sizes.scaleX*.5>>0,this.localPosition.y-=this.sizes.height*this.sizes.scaleY*.5>>0},this)}return u.prototype=new e,u.prototype.constructor=u,u.prototype.supr=e.prototype,u.prototype.DEName="SpriteRenderer",u.prototype.render=r,u.prototype.setFrame=function(e){e+1>=this
.endFrame?this.currentFrame=this.endFrame-1:e<this.startFrame?this.currentFrame=this.startFrame:this.currentFrame=e},u.prototype.setLine=function(e){e+1>=this.totalLine?this.currentLine=this.totalLine-1:this.currentLine=e},u.prototype.restartAnim=function(){this.isOver=!1,this.isReversed?this.currentFrame=this.endFrame-1:this.currentFrame=this.startFrame,this.lastAnim=s.currentTime},u.prototype.setPause=function(e,t){this.isPaused=e,!e&&!this.isAnimated&&(this.isAnimated=!0,this.lastAnim=Date.now())},u.prototype.setEndFrame=function(e){this.totalFrame<=e?this.endFrame=this.totalFrame-1:this.endFrame=e},u.prototype.setDelay=function(e){this.eachAnim=e},u.prototype.setLoop=function(e){this.isLoop=e},i.debug.log("SpriteRenderer loaded",3),u}),define("DE.Render",["DE.CONFIG","DE.Sizes","DE.Time","DE.MainLoop","DE.CollisionSystem","DE.Inputs","DE.CanvasBuffer"],function(e,t,n,r,i,s,o){function u(u,a){function f(){return{x:document.scrollLeft||window.pageXOffset,y:document.scrollTop||window.pageYOffset
}}function l(e,t,n){var r={x:e,y:t},i=this.canvas;while(i)r.x-=i.offsetLeft,r.y-=i.offsetTop,i=i.parentElement;return{x:r.x/c+f().x>>0,y:r.y/c+f().y>>0,index:n}}a=a||{},this.id=0,this.divId=u||undefined,this.canvas=null,this.ctx=null,this.sizes=new t(a.width||e.defaultRenderWidth||100,a.height||e.defaultRenderHeight||100,a.scaleX||1,a.scaleY||1),this.savedSizes=new t(a.width||e.defaultRenderWidth||100,a.height||e.defaultRenderHeight||100,a.scaleX||1,a.scaleY||1);var c=1;this.physicRatio=1,this.conserveSizes=a.conserveSizes||!1,this.fullScreenMode=a.fullScreen||null,this.cameras=new Array,this.maxCameras=0,this.freeze=!1,this.init=function(){if(this.inited)return;r.addRender(this);if(!this.divId)this.div=window.document.body,e.debug.log("%cWARN: you not specified a DOM Object where push the render, it will push in the body *hiiik*",1,"color:orange");else{this.div=document.getElementById(this.divId);if(!this.div)throw new Error("Can't found the div by the given id")}this.canvas=document.createElement
("canvas"),this.div.appendChild(this.canvas),s.addRender(this),this.ctx=this.canvas.getContext("2d"),this.buffer=new o(this.sizes.width,this.sizes.height),this.inited=!0,this.updateSizes()},this.updateSizes=function(){if(!this.inited)return;this.conserveSizes?(this.sizes.width=this.div.offsetWidth.valueOf(),this.sizes.height=this.div.offsetHeight.valueOf()):(this.div.style.width=this.sizes.width+"px",this.div.style.height=this.sizes.height+"px"),this.canvas.width=this.sizes.width.valueOf(),this.canvas.height=this.sizes.height.valueOf(),this.canvas.id=this.id,this.fullScreenMode&&(this.fullScreen(this.fullScreenMode),this.resizeOnEventResize()),this.buffer.resize(this.sizes.width,this.sizes.height)},this.screenChangedSizeIndex=function(e,t){this.savedSizes.width=t.w,this.savedSizes.height=t.h,this.physicRatio=e,this.updateSizes();for(var n=0,r;r=this.cameras[n];++n)r.screenChangedSizeIndex(e,t)},this.resize=function(e,t,n){this.div!=window.document.body&&(this.div.style.width=e+"px",this
.div.style.height=t+"px"),this.canvas.width=e,this.canvas.height=t,this.sizes.width=e,this.sizes.height=t},this.resizeOnEventResize=function(){if(!this.fullScreenMode)return;var e=this,t=function(){e.fullScreenMethod.call(e)};window.addEventListener?window.addEventListener("resize",function(){window.setTimeout(t,100)},!1):window.attachEvent&&window.attachEvent("onresize",function(){window.setTimeout(t,100)})},this.resizeRatio=function(e,t,n){var r=this.savedSizes.width,i=this.savedSizes.height,s=e/r;s*i>t&&(s=t/i);var o=s*r>>0,u=s*i>>0;this.resize(o,u,n),this.div.style.marginLeft=(e-o)/2+"px",this.div.style.marginTop=(t-u)/2+"px",this.canvas.style.top=0,c=o/this.savedSizes.width};var h;this.changeFullScreenMode=function(e){this.fullScreenMode=e;switch(e){case"ratioStretch":h=function(e,t){this.resizeRatio(e,t,!0)};break;case"fullStretch":h=function(e,t){this.resize(e,t,!0)};break;case"ratio":h=function(e,t){this.resizeRatio(e,t,!1)};break;default:h=function(e,t){}}},this.fullScreenMethod=
function(){var e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight,n=window.getComputedStyle(this.div.parentElement,null).getPropertyValue("height");if(this.div.parentElement!=null&&n&&t<document.body.clientHeight){var r=this.div.parentElement.innerWidth||this.div.parentElement.clientWidth,i=this.div.parentElement.innerHeight||this.div.parentElement.clientHeight;i<t&&(t=i),r<e&&(e=r)}if(!h)throw"Render.js : fullScreenMethod need a fullScreenMode, maybe you never used changeFullScreenMode";h.call(this,e,t)},this.fullScreen=function(e,t){e&&this.changeFullScreenMode(e),t,this.fullScreenMethod()},this.render=function(){if(this.freeze)return;this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.sizes.width,this.sizes.height);for(var t=0,r;r=this.cameras[t];++t)r.render(this.ctx,c,this.physicRatio);e.DEBUG_LEVEL>0&&(this.ctx.font="24px Arial",this.ctx.fillStyle="white",this.ctx.fillText("DeltaTime: "+n.deltaTime,(this.sizes.width>>0
)-220,30),this.ctx.fillText("MissedFrame: "+n.missedFrame,(this.sizes.width>>0)-220,60),this.ctx.fillText("FPS: "+n.fps,(this.sizes.width>>0)-220,90))},this.add=function(e){this.cameras.push(e),this.maxScenes++,e.screenChangedSizeIndex(this.physicRatio,this.savedSizes)},this.remove=function(t){var n=this.cameras.indexOf(t);if(n==-1){e.debug.log("Remove camera not found ",1,t);return}this.cameras.splice(n,1),this.maxScenes--},this.camerasMouseCollide=function(e,t,n,r){var s=l.call(this,t,n,r);if(this["on"+e](s)||s.stopPropagation)return s;for(var o=0,u,a;o<this.cameras.length;o++){u=this.cameras[o];if(u.sleep)continue;a={x:u.position.x-u.sizes.width*.5*u.sizes.scaleX,y:u.position.y-u.sizes.height*.5*u.sizes.scaleY,width:u.sizes.width*u.sizes.scaleX,height:u.sizes.height*u.sizes.scaleY};if(i.pointFixedBoxCollision(s,a)){if(!u.indexMouseOver[r]&&u.oOnMouseEnter(s,this.physicRatio))break;if(u["oOn"+e](s,this.physicRatio))break}else if(u.indexMouseOver[r]&&u.oOnMouseLeave(s,this.physicRatio)
)break}return s.stopPropagation||this["lastOn"+e](s),s},this.onMouseMove=function(){},this.onMouseDown=function(){},this.onMouseUp=function(){},this.lastOnMouseMove=function(){},this.lastOnMouseDown=function(){},this.lastOnMouseUp=function(){},this.oOnMouseDown=function(e){this.camerasMouseCollide("MouseDown",e.x,e.y,e.index)},this.oOnMouseUp=function(e){this.camerasMouseCollide("MouseUp",e.x,e.y,e.index)},this.oOnMouseMove=function(e){this.camerasMouseCollide("MouseMove",e.x,e.y,e.index)}}return u.prototype.DEName="Render",e.debug.log("Render loaded",3),u}),define("DE.Camera",["DE.CONFIG","DE.Sizes","DE.Vector2","DE.CanvasBuffer","DE.CollisionSystem","DE.ImageManager","DE.Event"],function(e,t,n,r,i,s,o){function u(e,i,s,u,a){a=a||{},this.name=a.name||"",this.tag=a.tag||"",this.scene=null,this.gui=undefined,this.sizes=new t(e,i,a.scale||a.scaleX||1,a.scale||a.scaleY||1),this.savedSizes=new t(e,i,a.scale||a.scaleX||1,a.scale||a.scaleY||1),this.position=new n(s+e*.5,u+i*.5,a.z||-10),this.
savedPosition=new n(s+e*.5,u+i*.5,a.z||-10),this.realposition=new n(a.realx||s,a.realy||u,a.realz||a.z||-10),this.limits={minX:a.minX!=undefined?a.minX:undefined,maxX:a.maxX!=undefined?a.maxX:undefined,minY:a.minY!=undefined?a.minY:undefined,maxY:a.maxY!=undefined?a.maxY:undefined},this.opacity=a.opacity||1,this.backgroundColor=a.backgroundColor||null,this.backgroundImage=a.backgroundImage||null,this.cameras=new Array,this.maxCameras=0,this.indexMouseOver=[0,0,0,0,0,0,0,0,0,0,0,0],this.lastPointersPos={},this.freeze=!1,this.sleep=!1,this.startX=0,this.startY=0,this._buffer=new r(this.sizes.width,this.sizes.height),this._gameObjects=[],this._visibleGameObjects=[],o.addEventComponents(this)}function a(e,t,n){if(t.disable)return!1;if(t.collider&&(t["onMouse"+e]||t.onMouseLeave||t.onMouseEnter)){var r=t.indexMouseOver[n.index];if(i.checkCollisionWith(n,t.collider)){t.indexMouseOver[n.index]=!0;if(!r&&t.onMouseEnter&&t.onMouseEnter(n))return!0;if(t["onMouse"+e]&&t["onMouse"+e](n))return!0}else if(
r&&t.onMouseLeave){t.indexMouseOver[n.index]=!1;if(t.onMouseLeave(n))return!0}}for(var s=0,o;o=t.childrens[s];++s)if(a(e,o,n))return!0}return u.prototype.getBuffer=function(){return this._buffer},u.prototype.render=function(t,n,r){if(this.sleep)return;var i=this._buffer;if(!this.freeze){i.ctx.globalAlpha=this.opacity,this.backgroundColor!=null&&(i.ctx.fillStyle=this.backgroundColor,i.ctx.fillRect(0,0,this.sizes.width,this.sizes.height)),this.backgroundImage!=null&&i.ctx.drawImage(s.images[this.backgroundImage],0,0,this.sizes.width,this.sizes.height),i.ctx.save();if(this.scene){var o=this._gameObjects=this.scene.getGameObjects();this._visibleGameObjects=[];for(var u=0,a=o.length,f,l;u<a;u++)f=o[u],f&&!f.disable&&f.position.z>this.realposition.z&&f.position.x+f.biggerOffset.width>=this.realposition.x&&f.position.x-f.biggerOffset.width<=this.realposition.x+this.savedSizes.width&&f.position.y+f.biggerOffset.height>=this.realposition.y&&f.position.y-f.biggerOffset.height<=this.realposition.y+
this.savedSizes.height&&(this._visibleGameObjects.push(f),l=10/(f.position.z-this.realposition.z),f.render(i.ctx,r,l,this.realposition,this.sizes))}else i.ctx.textAlign="center",i.ctx.fillStyle="white",i.ctx.fillText("No scene affiliated :(",this.sizes.width*.5,this.sizes.height*.5);i.ctx.restore(),i.ctx.globalAlpha=this.opacity,e.DEBUG&&(i.ctx.fillStyle="white",i.ctx.textAlign="left",i.ctx.fillText("Camera "+this.name,10,20),i.ctx.strokeStyle="red",i.ctx.strokeRect(0,0,this.sizes.width>>0,this.sizes.height>>0),i.ctx.fillStyle="yellow",i.ctx.fillRect(this.sizes.width-10,this.sizes.height-10,10,10),i.ctx.fillRect(this.sizes.width-10,0,10,10),i.ctx.fillRect(0,this.sizes.height-10,10,10),i.ctx.fillRect(0,0,10,10),i.ctx.fillRect(this.sizes.width*.5,this.sizes.height*.5,20,5),i.ctx.fillRect(this.sizes.width*.5,this.sizes.height*.5,5,20)),this.getFocus(),this.checkLimits(),this.applyShake()}t.translate(this.position.x*n>>0,this.position.y*n>>0),t.rotate(this.position.rotation),t.drawImage(i.canvas
,-this.sizes.width*this.sizes.scaleX*n*.5>>0,-this.sizes.height*this.sizes.scaleY*n*.5>>0,this.sizes.width*this.sizes.scaleX*n>>0,this.sizes.height*this.sizes.scaleY*n>>0),this.gui&&this.gui.render(t,this.position,this.sizes,n,r),t.rotate(-this.position.rotation),t.translate(-this.position.x*n>>0,-this.position.y*n>>0)},u.prototype.checkLimits=function(){var e=this.limits;e.minX!=undefined&&this.realposition.x<e.minX?this.realposition.x=e.minX:e.maxX!=undefined&&this.realposition.x+this.sizes.width>e.maxX&&(this.realposition.x=e.maxX-this.sizes.width),e.minY!=undefined&&this.realposition.y<e.minY?this.realposition.y=e.minY:e.maxY!=undefined&&this.realposition.y+this.sizes.height>e.maxY&&(this.realposition.y=e.maxY-this.sizes.height)},u.prototype.screenChangedSizeIndex=function(e,t){this.sizes.width=this.savedSizes.width*e>>0,this.sizes.height=this.savedSizes.height*e>>0,this.position.x=this.savedPosition.x*e>>0,this.position.y=this.savedPosition.y*e>>0,this._buffer.canvas.width=this.sizes
.width,this._buffer.canvas.height=this.sizes.height},u.prototype.add=function(e){this.cameras.push(e),++this.maxCameras},u.prototype.remove=function(t){var n=this.cameras.indexOf(t);if(n==-1){e.debug.log("%cRemove camera not found ",1,"color:orange",t);return}this.cameras.splice(n,1),this.maxCameras--},u.prototype.shake=function(e,t,n){this.shakeData={startedAt:Date.now(),duration:n,xRange:e,yRange:t,prevX:0,prevY:0}},u.prototype.applyShake=function(){if(!this.shakeData)return;var e=this.shakeData;this.realposition.x-=e.prevX,this.realposition.y-=e.prevY;if(Date.now()-this.shakeData.startedAt>this.shakeData.duration){delete this.shakeData;return}e.prevX=-(Math.random()*e.xRange)+Math.random()*e.xRange>>0,e.prevY=-(Math.random()*e.yRange)+Math.random()*e.yRange>>0,this.realposition.x+=e.prevX,this.realposition.y+=e.prevY},u.prototype.focus=function(e,t){this.target=e,this.focusLocks=t},u.prototype.getFocus=function(){if(!this.target)return;var e=this.target.getPos(),t=(Math.abs(this.realposition
.z+e.z)-10)*.1+1;this.focusLocks.x||(this.realposition.x=e.x-this.sizes.width*.5/t),this.focusLocks.y||(this.realposition.y=e.y-this.sizes.height*.5/t)},u.prototype.convertMousePos=function(e,t){var n=this.position.getHarmonics();if(n.sin==0&&n.cos==0)return this.sizes.scaleX!=1||this.sizes.scaleY!=1?{x:(e.x/t-(this.sizes.width-this.sizes.width*this.sizes.scaleX)/2)/this.sizes.scaleX>>0,y:(e.y/t-(this.sizes.height-this.sizes.height*this.sizes.scaleY)/2)/this.sizes.scaleY>>0,index:e.index}:{x:e.x/t>>0,y:e.y/t>>0,index:e.index};var r=this.sizes.width/2-e.x,i=this.sizes.height/2-e.y;return this.sizes.scaleX!=1||this.sizes.scaleY!=1?{x:((-(r*n.cos+i*n.sin)+this.sizes.width/2)/t-(this.sizes.width-this.sizes.width*this.sizes.scaleX)/2)/this.sizes.scaleX>>0,y:((r*n.sin+i*-n.cos+this.sizes.height/2)/t-(this.sizes.height-this.sizes.height*this.sizes.scaleY)/2)/this.sizes.scaleY>>0,index:e.index}:{x:(-(r*n.cos+i*n.sin)+this.sizes.width/2)/t>>0,y:(r*n.sin+i*-n.cos+this.sizes.height/2)/t>>0,index:e
.index}},u.prototype.onMouseDown=function(){},u.prototype.onMouseUp=function(){},u.prototype.onMouseMove=function(){},u.prototype.onMouseEnter=function(){},u.prototype.onMouseLeave=function(){},u.prototype.lastOnMouseMove=function(){},u.prototype.lastOnMouseDown=function(){},u.prototype.lastOnMouseUp=function(){},u.prototype.oOnMouseDown=function(e,t){this.mouseDetectorHandler("Down",e,t)},u.prototype.oOnMouseUp=function(e,t){this.mouseDetectorHandler("Up",e,t)},u.prototype.oOnMouseMove=function(e,t){this.lastPointersPos[e.index]=e,this.indexMouseOver[e.index]=!0,this.mouseDetectorHandler("Move",e,t)},u.prototype.oOnMouseEnter=function(e,t){e=this.convertMousePos(e,t),this.onMouseEnter(e)},u.prototype.oOnMouseLeave=function(e,t){this.indexMouseOver[e.index]=!1,e=this.convertMousePos(e,t),this.onMouseLeave(e)},u.prototype.mouseDetectorHandler=function(e,t,n){if(this.freeze||this.sleep)return;t=this.convertMousePos(t,n),this.trigger("mouse"+e,t);if(this["onMouse"+e](t)||t.stopPropagation)
return;if(this.gui&&this.gui["onMouse"+e](t)||t.stopPropagation)return;t.x+=this.realposition.x,t.y+=this.realposition.y;for(var r=this._visibleGameObjects.length-1,i;r>=0;--r){i=this._visibleGameObjects[r];if(a(e,i,t))return}t.stopPropagation||(this.trigger("lastMouse"+e,t),this["lastOnMouse"+e](t))},o.addEventCapabilities(u),u.prototype.DEName="Camera",e.debug.log("Camera loaded",3),u}),define("DE.TextRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.globalAlpha=this.alpha,e.drawImage(this.buffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.sizes.width*this.sizes.scaleX*t*n>>0,this.sizes.height*this.sizes.scaleY*t*n>>0),e.globalAlpha=r}return e.debug.log("TextRenderer.render loaded",3),t}),define("DE.TextRenderer",["DE.Renderer","DE.TextRenderer.render","DE.CONFIG","DE.Sizes","DE.CanvasBuffer"],function(e,t,n,r,i){function s(t,n,s,o){e.call(this,t);if(!t||!n||!s||!o)throw new Error("TextRenderer :: Can't instantiate without param, width, height, text"
);this.text=o||undefined,this.sizes=new r(n,s,1,1),this.localPosition.x-=n*.5,this.localPosition.y-=s*.5,t.offsetX!=undefined&&(this.localPosition.x=t.offsetX+(t.x||0)),t.offsetY!=undefined&&(this.localPosition.y=t.offsetY+(t.y||0)),this.fontSize=t.fontSize||20,this.font=t.font||"Calibri",this.init=function(){this.buffer=new i(this.sizes.width,this.sizes.height),this.clearBuffer()},this.clearBuffer=function(){this.buffer.ctx.clearRect(0,0,this.sizes.width,this.sizes.height),this.buffer.ctx.font=this.fontSize+"pt "+this.font,this.buffer.ctx.textAlign="center",this.buffer.ctx.textBaseline="middle",this.fillColor&&(this.buffer.ctx.fillStyle=this.fillColor,this.forceWidth?this.buffer.ctx.fillText(this.text,this.sizes.width*.5,this.sizes.height*.5,this.sizes.width):this.buffer.ctx.fillText(this.text,this.sizes.width*.5,this.sizes.height*.5)),this.strokeColor&&(this.fillColor&&(this.buffer.ctx.globalAlpha=.8),this.buffer.ctx.strokeStyle=this.strokeColor,this.forceWidth?this.buffer.ctx.strokeText
(this.text,this.sizes.width*.5,this.sizes.height*.5,this.sizes.width):this.buffer.ctx.fillText(this.text,this.sizes.width*.5,this.sizes.height*.5))},this.setText=function(e){this.text=e,this.clearBuffer(),this.onSetText(e)},this.onSetText=function(e){},this.changeSizes=function(e,t){var n=e-this.sizes.width;this.sizes.width=e;var r=t-this.sizes.height;this.sizes.height=t,this.localPosition.x-=n*.5,this.localPosition.y-=r*.5},this.init(t)}return s.prototype=new e,s.prototype.constructor=s,s.prototype.supr=e.prototype,s.prototype.DEName="TextRenderer",s.prototype.render=t,n.debug.log("TextRenderer loaded",3),s}),define("DE.TileRenderer.render",["DE.ImageManager","DE.CONFIG","DE.Time"],function(e,t,n){function r(t,n,r){t.globalAlpha=this.alpha,e.imageNotRatio?t.drawImage(e.images[this.imageName],this.tileposition.x*n>>0,this.tileposition.y*n>>0,this.tilesizes.width*n+1>>0,this.tilesizes.height*n+1>>0,this.localPosition.x*n*r>>0,this.localPosition.y*n*r>>0,this.sizes.width*this.sizes.scaleX*
n*r+2>>0,this.sizes.height*this.sizes.scaleY*n*r+1>>0):t.drawImage(e.images[this.imageName],this.tileposition.x,this.tileposition.y,this.tilesizes.width,this.tilesizes.height,this.localPosition.x*r>>0,this.localPosition.y*r>>0,this.sizes.width*this.sizes.scaleX*r>>0,this.sizes.height*this.sizes.scaleY*r>>0),t.globalAlpha=1}return t.debug.log("TileRenderer.render loaded",3),r}),define("DE.TileRenderer",["DE.Renderer","DE.ImageManager","DE.Vector2","DE.Sizes","DE.TileRenderer.render","DE.CONFIG"],function(e,t,n,r,i,s){function o(i){if(!i)throw new Error("TileRenderer :: You have to pass arguments object to instantiate -- see the doc");e.call(this,i),this.imageName=i.imageName||undefined;if(!this.imageName)throw new Error("TileRenderer :: No imageName defined -- declaration canceled");if(!t.images[this.imageName])throw new Error("TileRenderer :: Can't find image "+this.imageName+" in imagesDatas");i.tilesizes=i.tilesizes||i.tileSizes||{},this.tilesizes=new r(i.tilesizes.width||i.tilesizes.
w||i.width||10,i.tilesizes.height||i.tilesizes.h||i.height||10,1,1),i.tileposition=i.tileposition||i.tilePosition||{},this.tileposition=new n(i.tileposition.x||i.x||0,i.tileposition.y||i.y||0),this.tileposition||console.error("Tile position must be defined"),i.scaleX=i.scale||i.scaleX||i.scalex||1,i.scaleY=i.scale||i.scaleY||i.scaley||1,i.sizes=i.sizes||{},this.sizes=new r(i.sizes.width||i.width||i.w||i.tilesizes.width||10,i.sizes.height||i.height||i.h||i.tilesizes.height||10,i.scaleX,i.scaleY),this.localPosition.x-=this.sizes.width*this.sizes.scaleX*.5,this.localPosition.y-=this.sizes.height*this.sizes.scaleY*.5}return o.prototype=new e,o.prototype.constructor=o,o.prototype.supr=e.prototype,o.prototype.DEName="TileRenderer",o.prototype.render=i,s.debug.log("TileRenderer loaded",3),o}),define("buzz",[],function(){var e={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac"
,m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(t,n){function r(e){var t=[],n=e.length-1;for(var r=0;r<=n;r++)t.push({start:e.start(n),end:e.end(n)});return t}function i(e){return e.split(".").pop()}function s(t,n){var r=document.createElement("source");r.src=n,e.types[i(n)]&&(r.type=e.types[i(n)]),t.appendChild(r)}n=n||{};var o=0,u=[],a={},f=e.isSupported();this.load=function(){return f?(this.sound.load(),this):this},this.play=function(){return f?(this.sound.play(),this):this},this.togglePlay=function(){return f?(this.sound.paused?this.sound.play():this.sound.pause(),this):this},this.pause=function(){return f?(this.sound.pause(),this):this},this.isPaused=function(){return f?this.sound.paused:null},this.stop=function(){return f?(this.setTime(0),this.sound.pause(),this):this},this.isEnded=function(){return f?this.sound.ended:null},this.loop=function(){return f?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){this.currentTime=0,this.play()}),this
):this},this.unloop=function(){return f?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return f?(this.sound.muted=!0,this):this},this.unmute=function(){return f?(this.sound.muted=!1,this):this},this.toggleMute=function(){return f?(this.sound.muted=!this.sound.muted,this):this},this.isMuted=function(){return f?this.sound.muted:null},this.setVolume=function(e){return f?(e<0&&(e=0),e>100&&(e=100),this.volume=e,this.sound.volume=e/100,this):this},this.getVolume=function(){return f?this.volume:this},this.increaseVolume=function(e){return this.setVolume(this.volume+(e||1))},this.decreaseVolume=function(e){return this.setVolume(this.volume-(e||1))},this.setTime=function(e){return f?(this.whenReady(function(){this.sound.currentTime=e}),this):this},this.getTime=function(){if(!f)return null;var t=Math.round(this.sound.currentTime*100)/100;return isNaN(t)?e.defaults.placeholder:t},this.setPercent=function(t){return f?this.setTime(e.fromPercent(t,
this.sound.duration)):this},this.getPercent=function(){if(!f)return null;var t=Math.round(e.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(t)?e.defaults.placeholder:t},this.setSpeed=function(e){if(!f)return this;this.sound.playbackRate=e},this.getSpeed=function(){return f?this.sound.playbackRate:null},this.getDuration=function(){if(!f)return null;var t=Math.round(this.sound.duration*100)/100;return isNaN(t)?e.defaults.placeholder:t},this.getPlayed=function(){return f?r(this.sound.played):null},this.getBuffered=function(){return f?r(this.sound.buffered):null},this.getSeekable=function(){return f?r(this.sound.seekable):null},this.getErrorCode=function(){return f&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!f)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(
){return f?this.sound.readyState:null},this.getStateMessage=function(){if(!f)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return f?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!f)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(e,t){return f?(this.sound[e]=t,this):this},this.get=function(e){return f?e?this.sound[e]:this.sound:null},this.bind=function(e,t){if(!f)return this;e=e.split(" ");var n=this,r=function(e){t.call(n,e)};for(var i=0;i<e.length;i++){var s=e[i],o=s;s=o.split(".")[0],u.push({idx:o,func:r}),this.sound.addEventListener(s,r,!0)}return this},this.unbind=function(e){if(!f)return this;e=e.
split(" ");for(var t=0;t<e.length;t++){var n=e[t],r=n.split(".")[0];for(var i=0;i<u.length;i++){var s=u[i].idx.split(".");if(u[i].idx==n||s[1]&&s[1]==n.replace(".",""))this.sound.removeEventListener(r,u[i].func,!0),u.splice(i,1)}}return this},this.bindOnce=function(e,t){if(!f)return this;var n=this;a[o++]=!1,this.bind(e+"."+o,function(){a[o]||(a[o]=!0,t.call(n)),n.unbind(e+"."+o)})},this.trigger=function(e){if(!f)return this;e=e.split(" ");for(var t=0;t<e.length;t++){var n=e[t];for(var r=0;r<u.length;r++){var i=u[r].idx.split(".");if(u[r].idx==n||i[0]&&i[0]==n.replace(".","")){var s=document.createEvent("HTMLEvents");s.initEvent(i[0],!1,!0),this.sound.dispatchEvent(s)}}}return this},this.fadeTo=function(t,n,r){function i(){setTimeout(function(){s<t&&u.volume<t?(u.setVolume(u.volume+=1),i()):s>t&&u.volume>t?(u.setVolume(u.volume-=1),i()):r instanceof Function&&r.apply(u)},o)}if(!f)return this;n instanceof Function?(r=n,n=e.defaults.duration):n=n||e.defaults.duration;var s=this.volume,o=n/
Math.abs(s-t),u=this;return this.play(),this.whenReady(function(){i()}),this},this.fadeIn=function(e,t){return f?this.setVolume(0).fadeTo(100,e,t):this},this.fadeOut=function(e,t){return f?this.fadeTo(0,e,t):this},this.fadeWith=function(e,t){return f?(this.fadeOut(t,function(){this.stop()}),e.play().fadeIn(t),this):this},this.whenReady=function(e){if(!f)return null;var t=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){e.call(t)}):e.call(t)};if(f&&t){for(var l in e.defaults)e.defaults.hasOwnProperty(l)&&(n[l]=n[l]||e.defaults[l]);this.sound=document.createElement("audio");if(t instanceof Array)for(var c in t)t.hasOwnProperty(c)&&s(this.sound,t[c]);else if(n.formats.length)for(var h in n.formats)n.formats.hasOwnProperty(h)&&s(this.sound,t+"."+n.formats[h]);else s(this.sound,t);n.loop&&this.loop(),n.autoplay&&(this.sound.autoplay="autoplay"),n.preload===!0?this.sound.preload="auto":n.preload===!1?this.sound.preload="none":this.sound.preload=n.preload,this.setVolume
(n.volume),e.sounds.push(this)}},group:function(e){function t(){var t=n(null,arguments),r=t.shift();for(var i=0;i<e.length;i++)e[i][r].apply(e[i],t)}function n(e,t){return e instanceof Array?e:Array.prototype.slice.call(t)}e=n(e,arguments),this.getSounds=function(){return e},this.add=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++)e.push(t[r])},this.remove=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++)for(var i=0;i<e.length;i++)if(e[i]==t[r]){e.splice(i,1);break}},this.load=function(){return t("load"),this},this.play=function(){return t("play"),this},this.togglePlay=function(){return t("togglePlay"),this},this.pause=function(e){return t("pause",e),this},this.stop=function(){return t("stop"),this},this.mute=function(){return t("mute"),this},this.unmute=function(){return t("unmute"),this},this.toggleMute=function(){return t("toggleMute"),this},this.setVolume=function(e){return t("setVolume",e),this},this.increaseVolume=function(e){return t("increaseVolume",e),this},this.
decreaseVolume=function(e){return t("decreaseVolume",e),this},this.loop=function(){return t("loop"),this},this.unloop=function(){return t("unloop"),this},this.setTime=function(e){return t("setTime",e),this},this.set=function(e,n){return t("set",e,n),this},this.bind=function(e,n){return t("bind",e,n),this},this.unbind=function(e){return t("unbind",e),this},this.bindOnce=function(e,n){return t("bindOnce",e,n),this},this.trigger=function(e){return t("trigger",e),this},this.fade=function(e,n,r,i){return t("fade",e,n,r,i),this},this.fadeIn=function(e,n){return t("fadeIn",e,n),this},this.fadeOut=function(e,n){return t("fadeOut",e,n),this}},all:function(){return new e.group(e.sounds)},isSupported:function(){return!!e.el.canPlayType},isOGGSupported:function(){return!!e.el.canPlayType&&e.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!e.el.canPlayType&&e.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!e.el.canPlayType&&e.el.canPlayType("audio/mpeg;"
)},isAACSupported:function(){return!!e.el.canPlayType&&(e.el.canPlayType("audio/x-m4a;")||e.el.canPlayType("audio/aac;"))},toTimer:function(e,t){var n,r,i;return n=Math.floor(e/3600),n=isNaN(n)?"--":n>=10?n:"0"+n,r=t?Math.floor(e/60%60):Math.floor(e/60),r=isNaN(r)?"--":r>=10?r:"0"+r,i=Math.floor(e%60),i=isNaN(i)?"--":i>=10?i:"0"+i,t?n+":"+r+":"+i:r+":"+i},fromTimer:function(e){var t=e.toString().split(":");return t&&t.length==3&&(e=parseInt(t[0],10)*3600+parseInt(t[1],10)*60+parseInt(t[2],10)),t&&t.length==2&&(e=parseInt(t[0],10)*60+parseInt(t[1],10)),e},toPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(e*100/t*r)/r},fromPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(t/100*e*r)/r}};return e}),define("DE.AudioManager",["DE.CONFIG","buzz"],function(e,t){var n=new function(){this.DEName="AudioManager",this.muted=!1,this.volume=40,this.loadAudios=function(e){this.music.volume=this.volume,this.fx.volume=this.volume*.75;for(var n=0;n<e.length;++n){var r=e[
n],i={};i.name=r[0],i.preload=r[3].preload,i.loop=r[3].loop,i.formats=r[2].formats,i.sound=new t.sound(r[1],{formats:r[2],preload:r[3].preload||!1,loop:r[3].loop||!1}),r[3].isMusic?this.music.add(i):this.fx.add(i)}this.setVolume(this.volume)},this.mute=function(){this.music.mute(),this.fx.mute(),this.muted=!0},this.unmute=function(){this.music.unmute(),this.fx.unmute(),this.muted=!1},this.toggle=function(){this.muted?this.unmute():this.mute()},this.setVolume=function(e,t){t=="+"?this.volume+=e:t=="-"?this.volume-=e:this.volume=e,this.checkVolume();var n=this.volume;this.music.setVolume(n);var r=this.volume*.75;this.fx.setVolume(r)},this.checkVolume=function(){this.volume=(this.volume>100?100:this.volume)>>0,this.volume=(this.volume<0?0:this.volume)>>0},this.music=new function(){var e={};this.volume=80,this.muted=!1,this.currentPlayed="",this.get=function(t){return e[t]},this.add=function(t){e[t.name]=t},this.stopAllAndPlay=function(t,n){if(!n)var n=!1;if(!e[t]||!e[t].sound)return;for(var r in 
e){if(!this.muted&&(r==t||r==n))continue;e[r].sound.stop()}if(this.muted)return;if(!e[t].sound.isPaused())return;this.currentPlayed=t,e[t].sound.setTime(0),e[t].sound.play(),e[t].sound.setVolume(this.volume),e[t].sound.loop()},this.pauseAllAndPlay=function(t){for(var n in e)e[n].sound.isPaused()||e[n].sound.pause();if(this.muted)return;this.currentPlayed=t,e[t].sound.play(),e[t].sound.setVolume(this.volume)},this.mute=function(){this.muted=!0;for(var t in e)e[t].sound.stop()},this.unmute=function(){this.muted=!1,this.stopAllAndPlay(this.currentPlayed)},this.setVolume=function(t){this.volume=t||0;for(var n in e)e[n].sound.setVolume(this.volume)}},this.fx=new function(){var e={};this.volume=80,this.muted=!1,this.get=function(t){return e[t]},this.add=function(t){e[t.name]=t},this.play=function(t){if(this.muted)return;e[t].sound.isPaused()||e[t].sound.stop(),e[t].sound.play()},this.mute=function(){this.muted=!0;for(var t in e)e[t].sound.stop()},this.unmute=function(){this.muted=!1},this.setVolume=
function(t){this.volume=t||0;for(var n in e)e[n].sound.setVolume(this.volume)}}};return e.debug.log("AudioManager loaded",3),n}),define("DE.Gui",["DE.CONFIG","DE.COLORS","DE.Inputs","DE.CanvasBuffer"],function(e,t,n,r){function i(s,o){if(!s)throw new Error("Gui :: You have to pass at least a camera to instantiate -- see the doc");o=o||{},this.id=o.id||undefined,this.isVisible=o.isVisible||!0,this.opacity=o.opacity||1,this.components=o.components||{};var u=new r(s.sizes.width,s.sizes.height);this.needUpdate=!0,this.update=function(e){if(this.needUpdate)for(var t in i.components){var n=i.components[t];typeof n.update!="undefined"&&n.update(e)}},this.render=function(n,r,i,s,o){if(this.needUpdate){for(var a in this.components){if(this.components[a].disable){this.components[a].isDisable||this.components[a].clearMe(u.ctx);continue}this.components[a].oRender(u.ctx,i)}e.DEBUG&&(u.ctx.fillStyle=t.DEBUG.GUI,u.ctx.fillText("GUI "+this.id,20,u.canvas.height-20)),this.needUpdate=!1}var f=n.globalAlpha
;n.globalAlpha=this.opacity,n.drawImage(u.canvas,-i.width*i.scaleX*s*.5>>0,-i.height*i.scaleY*s*.5>>0,i.width*i.scaleX*s>>0,i.height*i.scaleY*s>>0),n.globalAlpha=f},this.add=function(t){this.components[t.id]&&(e.debug.log("%cComponent override an older:: "+t.id,1,"color:orange"),delete this.components[t.id]),this.components[t.id]=t,this.components[t.id].gui=this},this.remove=function(t){if(!this.components[t]){e.debug.log("%cComponent "+t+" couldn't be found",1,"color:orange");return}this.components[t].gui=null,delete this.components[t]},this.onMouseMove=function(e){for(var t in this.components){if(this.components[t].disable)continue;var n=this.components[t];if(n.checkState&&n.checkState(e))return n.onMouseMove(e),!0}return!1},this.onMouseDown=function(e){for(var t in this.components){if(this.components[t].disable)continue;var n=this.components[t];if(n.checkState&&n.checkState(e))return n.onMouseDown(e),n.isClicked=!0,!0}return!1},this.onMouseUp=function(e){for(var t in this.components)
{if(this.components[t].disable)continue;var n=this.components[t];if(n.checkState&&n.checkState(e))return n.isClicked=!1,n.onMouseUp(e),!0}return!1},this.onMouseClick=function(e){n.mouseMove(e);for(var t in i.components){if(i.components[t].disable)continue;var r=i.components[t];typeof r.checkState!="undefined"&&(i.isFocus=r.checkState(n.mouse,!0))}},this.onKeyDown=function(e){for(var t in i.components){if(i.components[t].disable)continue;var n=i.components[t];typeof n.onKeyDown!="undefined"&&n.onKeyDown(e)}}}return i.isFocus=!1,i.components={},i.prototype.DEName="Gui",e.debug.log("Gui loaded",3),i}),define("DE.BaseGui",["DE.CONFIG","DE.COLORS","DE.Vector2","DE.Sizes"],function(e,t,n,r){function i(i){if(!i)throw new Error("BaseGui :: You have to pass arguments object to instantiate -- see the doc");if(i.ignore)return;this.gui=null,this.id=i.id||i.name||Date.now()+Math.random()*Date.now()>>0,this.name=i.name||null,this.disable=i.disable||!1,this.isDisable=!1,i.scaleX=i.scale||i.scaleX||i.scalex||1
,i.scaleY=i.scale||i.scaleY||i.scaley||1,this.position=new n(i.x||i.posX||i.posx||i.X||0,i.y||i.posY||i.posy||i.Y||0),this.sizes=new r(i.width||i.w||e.DEFAULT_SIZES.GUI.WIDTH,i.height||i.h||e.DEFAULT_SIZES.GUI.HEIGHT,i.scaleX,i.scaleY),this.isOver=!1,this.isClicked=!1,this.onMouseUp=function(){},this.onMouseMove=function(){},this.onMouseDown=function(){},this.oRender=function(n){this.isDisable=!1,n.clearRect(this.position.x,this.position.y,this.sizes.width*this.sizes.scaleX,this.sizes.height*this.sizes.scaleY),this.render(n),e.DEBUG&&(n.fillStyle=t.DEBUG.X_AXIS,n.fillRect(this.position.x,this.position.y,20,2),n.fillStyle=t.DEBUG.Y_AXIS,n.fillRect(this.position.x,this.position.y,2,20),n.strokeStyle=t.DEBUG.GUI,n.strokeRect(this.position.x+1,this.position.y+1,this.sizes.width*this.sizes.scaleX-2,this.sizes.height*this.sizes.scaleY-2))},this.clearMe=function(e){this.isDisable=!0,e.clearRect(this.position.x,this.position.y,this.sizes.width*this.sizes.scaleX,this.sizes.height*this.sizes.scaleY
)},this.render=function(e,t,n){},this.checkState=function(e,t){return e.x>=this.position.x&&e.x<=this.position.x+this.sizes.width&&e.y>=this.position.y&&e.y<=this.position.y+this.sizes.height?(this.isOver=!0,this.gui.needUpdate=!0,!0):(this.isOver&&(this.isOver=!1,this.gui.needUpdate=!0),this.isClicked=0,!1)},this.hide=function(){this.disable||(this.gui.needUpdate=!0),this.disable=!0},this.show=function(){this.disable&&(this.gui.needUpdate=!0),this.disable=!1},this.toggle=function(){this.disable=Game.camera.gui.components["Click me plz"].disable^1,this.gui.needUpdate=!0}}return i.prototype.DEName="BaseGui",i}),define("DE.GuiButton",["DE.CONFIG","DE.COLORS","DE.BaseGui","DE.Vector2","DE.TextRenderer","DE.SpriteRenderer"],function(e,t,n,r,i,s){function o(t){if(!t)throw new Error("GuiButton :: You have to pass arguments object to instantiate -- see the doc");n.call(this,t),this.sizes.width==e.DEFAULT_SIZES.GUI.WIDTH&&(this.sizes.width=e.DEFAULT_SIZES.BUTTON.WIDTH),this.sizes.height==e.DEFAULT_SIZES
.GUI.HEIGHT&&(this.sizes.height=e.DEFAULT_SIZES.BUTTON.HEIGHT),this.noChangeOnRelease=t.noChangeOnRelease||!1,this.buffer=null,this.padding=new r(t.padding||t.paddingX||5,t.padding||t.paddingY||5),this.text=t.text||undefined,this.fontSize=t.fontSize||e.DEFAULT_SIZES.BUTTON.FONT_SIZE,this.textOffsets=new r(t.width*.5||e.DEFAULT_SIZES.BUTTON.WIDTH*.5,t.height*.5+e.DEFAULT_SIZES.BUTTON.OFFSET_TOP||e.DEFAULT_SIZES.BUTTON.HEIGHT*.5+e.DEFAULT_SIZES.BUTTON.OFFSET_TOP),this.currentState=0,this.maxState=3,this.init=function(e){this.buffer=document.createElement("canvas"),this.buffer.width=this.sizes.width*this.maxState,this.buffer.height=this.sizes.height,this.buffer.context=this.buffer.getContext("2d"),this.buffer.context.clearRect(0,0,this.buffer.width,this.buffer.height);var t;if(e.spriteName){t=new s({spriteName:e.spriteName,width:this.sizes.width,height:this.sizes.height}),t.localPosition.x+=this.sizes.width*.5,t.localPosition.y+=this.sizes.height*.5;var n=t.endFrame>this.maxState?this.maxState
:t.endFrame;for(var r=0;r<this.maxState;r++)r<n&&t.setFrame(r),t.render(this.buffer.context,1),t.localPosition.x+=this.sizes.width}else for(var r=0,o=0;r<this.maxState;r++)this.buffer.context.fillStyle="rgb(100,"+(70+70*r)+",100)",this.buffer.context.fillRect(o,0,this.sizes.width,this.sizes.height),o+=this.sizes.width;if(this.text!=undefined){e.textRenderer||(e.textRenderer=new i({fillColor:e.fillColor||undefined,strokeColor:e.strokeColor||undefined,fontSize:this.fontSize,x:this.padding.x,y:this.padding.y,offsetX:0,offsetY:0},this.sizes.width-this.padding.x*2,this.sizes.height-this.padding.x*2,this.text)),e.textOverRenderer||(e.textOverRenderer=e.textRenderer),e.textClickRenderer||(e.textClickRenderer=e.textRenderer);var o=this.sizes.width;e.textRenderer.render(this.buffer.context,1),e.textOverRenderer.localPosition.x+=o,e.textOverRenderer.render(this.buffer.context,1),e.textClickRenderer.localPosition.x+=o,e.textClickRenderer.render(this.buffer.context,1)}},this.render=function(e){this
.currentState=0,this.isClicked?this.currentState=2:this.isOver&&(this.currentState=1),e.clearRect(this.position.x,this.position.y,this.sizes.width,this.sizes.height),e.drawImage(this.buffer,this.currentState*this.sizes.width,0,this.sizes.width,this.sizes.height,this.position.x,this.position.y,this.sizes.width,this.sizes.height)},this.init(t)}return o.prototype=new n({ignore:!0}),o.prototype.constructor=n,o.prototype.supr=n.prototype,o.prototype.DEName="GuiButton",o}),define("DE.GuiLabel",["DE.CONFIG","DE.BaseGui","DE.TextRenderer"],function(e,t,n){function r(e,r){if(!e)throw new Error("GuiLabel :: You have to pass arguments object to instantiate -- see the doc");t.call(this,e),this.text=r,!e.fillColor&&!e.strokeColor&&(e.fillColor="white"),e.x=this.sizes.width*.5,e.y=this.sizes.height*.5,this.renderer=new n(e,this.sizes.width,this.sizes.height,r),this.render=function(e){e.translate(this.position.x,this.position.y),e.rotate(this.position.rotation),e.clearRect(0,0,this.sizes.width*this.sizes
.scaleX,this.sizes.height*this.sizes.scaleY),this.renderer.render(e,1,1),e.rotate(this.position.rotation),e.translate(-this.position.x,-this.position.y)},this.clearMe=function(e){this.isDisable=!0,e.translate(this.position.x,this.position.y),e.rotate(this.position.rotation),e.clearRect(0,0,this.sizes.width*this.sizes.scaleX,this.sizes.height*this.sizes.scaleY),e.rotate(-this.position.rotation),e.translate(-this.position.x,-this.position.y)},this.setText=function(e){this.renderer.text=e,this.text=e,this.renderer.clearBuffer(),this.gui&&(this.gui.needUpdate=!0),this.onSetText&&this.onSetText(e)},this.onSetText=!1}return r.prototype=new t({ignore:!0}),r.prototype.constructor=t,r.prototype.supr=t.prototype,r.prototype.DEName="GuiLabel",r}),define("DE.GuiImage",["DE.CONFIG","DE.BaseGui","DE.TileRenderer","DE.SpriteRenderer"],function(e,t,n,r){function i(e,i){if(!e)throw new Error("Image :: You have to pass arguments object to instantiate -- see the doc");t.call(this,e),delete e.x,delete e.y;
if(e.spriteName)this.renderer=new r(e);else{if(!e.imageName)throw new Error("[GUI IMAGE] Declaring a Gui image but can't find spriteName or imageName");this.renderer=new n(e)}this.renderer.localPosition.x=0,this.renderer.localPosition.y=0,this.render=function(e){e.translate(this.position.x,this.position.y),this.renderer.render(e,1,1),e.translate(-this.position.x,-this.position.y)}}return i.prototype=new t({ignore:!0}),i.prototype.constructor=t,i.prototype.supr=t.prototype,i.prototype.DEName="GuiImage",i}),define("DREAM_ENGINE",["DE.CONFIG","DE.COLORS","DE.Time","DE.Vector2","DE.Sizes","DE.ImageManager","DE.CollisionSystem","DE.Collider","DE.Renderer","DE.Scene","DE.Rigidbody","DE.CanvasBuffer","DE.GameObject","DE.FixedBoxCollider","DE.OrientedBoxCollider","DE.CircleCollider","DE.BoxRenderer","DE.CircleRenderer","DE.SpriteRenderer","DE.Render","DE.MainLoop","DE.Event","DE.States","DE.Inputs","DE.Camera","DE.TextRenderer","DE.TileRenderer","DE.AudioManager","DE.Gui","DE.BaseGui","DE.GuiButton"
,"DE.GuiLabel","DE.GuiImage","DE.LangSystem","DE.SystemDetection","DE.GamePad","DE.Screen","DE.about","DE.SaveSystem","DE.Notifications"],function(){var e={},t=Date.now();for(var n in arguments){var r=arguments[n],i=r.DEName;!i&&r.prototype&&(i=r.prototype.DEName);if(!i){console.log("%cNo name for "+n,"color:red",arguments[n]);continue}e[i]=arguments[n],delete e[i].DEName}return e.init=function(n){e.about.set(n.about),e.SaveSystem.init(n.saveModel,n.saveIgnoreVersion),e.LangSystem.init(n.dictionary),e.SystemDetection.initSystem(n.system,n.paramsSystem||{}),e.on("udpateScreenSizes",function(e,t){this.ImageManager.pathPrefix=t.path,this.ImageManager.imageNotRatio=t.notRatio||!1,this.ImageManager.ratioToConception=e,this.ImageManager.arrayLoader(n.images.imagesList),this.MainLoop.screenChangedSizeIndex(e,t)},e),e.Screen.init(n.images),e.Screen.udpateScreenSizes(),n.ignoreNotification||e.Notifications.init(n),e.GamePad.init(),n=n||{},n.loader=n.loader||{},n.loader.name=n.loader.name||"loader"
,n.loader.url=n.loader.url||"loader",n.loader.totalFrame=n.loader.totalFrame||16,n.loader.eachAnim=n.loader.eachAnim||45,n.loader.ext=n.loader.ext||"png",n.loader.isAnimated=!0,n.loader.scale=n.loader.scale||1,e.Event.on("notisLoadingImages",function(){e.MainLoop.loader=new e.SpriteRenderer({spriteName:"loader",scale:n.loader.scale}),n.onReady?n.onReady():console.log("%cNo initialisation function given","color:red"),n.onStart?e.Event.on("isReady",function(){var r=Date.now()-t;r>=5e3?(n.onStart(),e.SystemDetection.askToRate()):(e.CONFIG.debug.log("start in ",1e3-r,"ms"),setTimeout(function(){n.onStart(),e.SystemDetection.askToRate()},1e3-r))},e,!1):console.log("%cNo start function given","color:red"),e.ImageManager.arrayLoader(n.images.imagesList),e.AudioManager.loadAudios(n.audios),e.Inputs.init(n.inputs),n.customLoop&&(e.MainLoop.customLoop=n.customLoop)},e,!1),this.ImageManager.folderName=n.images.folderName,this.ImageManager.pushImage(n.loader.name,n.loader.url,n.loader.ext,n.loader)
},e.start=function(){e.States.up("isInited"),this.MainLoop.launched=!0,this.MainLoop.loop()},e.on=e.Event.on,e.deltaTime=e.Time.getDelta(),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e}),require(["DREAM_ENGINE","main"],function(e,t){return t(e),e}),define("requirev",[],function(){}),define("datas",[],function(){var e={coefAirReductor:.99,coefFloorReductor:.7,coefAirFriction:.9,maxAttractionForce:100,attractionForce:.1,player:{mass:10,jumpForce:-2.5,jumpIncrease:-0.2,moveSpeed:12},mob:{mass:10,jumpForce:-2.5,moveSpeed:5,life:5},components:{road:{name:"road",tag:"none",sprite:"back",isTile:1,sx:0,sy:0,tw:280,th:880,w:280,h:880,collider:{type:"box",w:280,h:120,r:50,l:0,t:200},zindex:0},big_house:{name:"big_house",tag:"none",sprite:"back",isTile:1,sx:280,sy:0,tw:700,th:900,w:700,h:900
,collider:!1,zindex:1},fat_house:{name:"fat_house",tag:"none",sprite:"back1",isTile:1,sx:0,sy:0,tw:900,th:720,w:900,h:720,collider:!1,zindex:1},endroad:{name:"endroad",tag:"none",sprite:"back2",isTile:1,sx:0,sy:0,tw:544,th:295,w:544,h:295,collider:{type:"box",w:390,h:200,r:50,l:-80,t:100},zindex:0},grass:{name:"grass",tag:"none",sprite:"back2",isTile:1,sx:0,sy:296,tw:781,th:295,w:781,h:295,collider:{type:"box",w:410,h:200,r:50,l:130,t:100},zindex:0},"no-coll-grass":{name:"grass",tag:"none",sprite:"back2",isTile:1,sx:0,sy:296,tw:781,th:295,w:781,h:295,collider:!1,zindex:1},smallcol:{name:"smallcol",tag:"none",sprite:"back2",isTile:1,sx:545,sy:0,tw:455,th:224,w:455,h:224,collider:!1,zindex:0},bigcol:{name:"bigcol",tag:"none",sprite:"back2",isTile:1,sx:0,sy:591,tw:696,th:323,w:696,h:323,collider:!1,zindex:0},cliff1:{name:"cliff1",tag:"none",sprite:"back3",isTile:1,sx:0,sy:0,tw:663,th:299,w:663,h:299,collider:!1,zindex:0},cliff2:{name:"cliff2",tag:"none",sprite:"back3",isTile:1,sx:0,sy:300,
tw:474,th:134,w:474,h:134,collider:!1,zindex:0},mirror:{name:"mirror",tag:"none",sprite:"back3",isTile:1,sx:664,sy:0,tw:134,th:299,w:134,h:299,collider:!1,zindex:0},sun:{name:"sun",tag:"none",sprite:"back3",isTile:1,sx:0,sy:434,tw:970,th:430,w:970,h:430,collider:!1,zindex:0}},levels:{1:{components:[{x:6050,y:270,name:"cliff1",zindex:0,rotation:0},{x:8370,y:260,name:"cliff2",zindex:0,rotation:0},{x:8610,y:962,name:"grass",zindex:0,rotation:0},{x:5140,y:824,name:"road",zindex:0,rotation:0},{x:5740,y:962,name:"grass",zindex:0,rotation:0},{x:2620,y:824,name:"road",zindex:0,rotation:0},{x:3740,y:824,name:"road",zindex:0,rotation:0},{x:380,y:824,name:"road",zindex:0,rotation:0},{x:2340,y:824,name:"road",zindex:0,rotation:0},{x:7380,y:962,name:"grass",zindex:0,rotation:0},{x:100,y:824,name:"road",zindex:0,rotation:0},{x:1780,y:824,name:"road",zindex:0,rotation:0},{x:2060,y:824,name:"road",zindex:0,rotation:0},{x:9430,y:962,name:"grass",zindex:0,rotation:0},{x:4300,y:824,name:"road",zindex:0,rotation
:0},{x:660,y:824,name:"road",zindex:0,rotation:0},{x:4020,y:824,name:"road",zindex:0,rotation:0},{x:1220,y:824,name:"road",zindex:0,rotation:0},{x:9840,y:962,name:"grass",zindex:0,rotation:0},{x:3180,y:824,name:"road",zindex:0,rotation:0},{x:3460,y:824,name:"road",zindex:0,rotation:0},{x:4580,y:824,name:"road",zindex:0,rotation:0},{x:1500,y:824,name:"road",zindex:0,rotation:0},{x:7010,y:410,name:"cliff2",zindex:0,rotation:0},{x:6560,y:962,name:"grass",zindex:0,rotation:0},{x:6150,y:962,name:"grass",zindex:0,rotation:0},{x:2900,y:824,name:"road",zindex:0,rotation:0},{x:4860,y:824,name:"road",zindex:0,rotation:0},{x:7790,y:962,name:"grass",zindex:0,rotation:0},{x:9020,y:962,name:"grass",zindex:0,rotation:0},{x:8200,y:962,name:"grass",zindex:0,rotation:0},{x:6970,y:962,name:"grass",zindex:0,rotation:0},{x:940,y:824,name:"road",zindex:0,rotation:0},{x:9040,y:80,name:"sun",zindex:0,rotation:0},{x:6550,y:540,name:"no-coll-grass",zindex:1,rotation:0},{x:8510,y:670,name:"no-coll-grass",zindex:1
,rotation:0},{x:7300,y:590,name:"no-coll-grass",zindex:1,rotation:0},{x:8720,y:160,name:"cliff1",zindex:1,rotation:0},{x:1040,y:390,name:"fat_house",zindex:1,rotation:0},{x:5430,y:530,name:"no-coll-grass",zindex:1,rotation:0},{x:5720,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:6210,y:530,name:"no-coll-grass",zindex:1,rotation:0},{x:6110,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:7020,y:590,name:"no-coll-grass",zindex:1,rotation:0},{x:9310,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:3700,y:230,name:"fat_house",zindex:1,rotation:0},{x:5800,y:530,name:"no-coll-grass",zindex:1,rotation:0},{x:9710,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:6920,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:7870,y:540,name:"no-coll-grass",zindex:1,rotation:0},{x:8280,y:540,name:"no-coll-grass",zindex:1,rotation:0},{x:8100,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:7710,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:8910,y:670,name:"no-coll-grass",zindex:1,rotation
:0},{x:6520,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:5550,y:962,name:"endroad",zindex:1,rotation:0},{x:7310,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:2760,y:160,name:"big_house",zindex:1,rotation:0},{x:5310,y:670,name:"no-coll-grass",zindex:1,rotation:0},{x:4590,y:190,name:"big_house",zindex:1,rotation:0},{x:2220,y:320,name:"fat_house",zindex:2,rotation:0},{x:3250,y:300,name:"big_house",zindex:2,rotation:0},{x:4780,y:410,name:"fat_house",zindex:2,rotation:0},{x:330,y:400,name:"big_house",zindex:2,rotation:0},{x:6570,y:430,name:"smallcol",zindex:2,rotation:0},{x:9190,y:260,name:"cliff2",zindex:2,rotation:0},{x:8890,y:450,name:"no-coll-grass",zindex:3,rotation:0},{x:8510,y:450,name:"no-coll-grass",zindex:3,rotation:0},{x:6130,y:480,name:"bigcol",zindex:3,rotation:0},{x:1920,y:270,name:"big_house",zindex:3,rotation:0},{x:9670,y:450,name:"no-coll-grass",zindex:4,rotation:0},{x:9280,y:450,name:"no-coll-grass",zindex:4,rotation:0},{x:8150,y:430,name:"bigcol",zindex:4,rotation
:0},{x:7500,y:440,name:"smallcol",zindex:4,rotation:0},{x:5750,y:540,name:"smallcol",zindex:4,rotation:0},{x:9460,y:360,name:"bigcol",zindex:6,rotation:0},{x:9590,y:840,name:"mirror",zindex:9,rotation:0}],mobs:[{x:2e3,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:2200,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:2500,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:2800,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:3e3,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:3200,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy"]},{x:3500,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy"]},{x:3700,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy"]},{x:4200,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy"]},{x:5500,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:6e3,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:6500
,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:7e3,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:7300,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:7600,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy"]},{x:8e3,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy"]},{x:8200,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy"]},{x:8500,y:550,radius:1500,mobs:["boy","boy","boy","boy","boy","boy","boy","boy","boy","boy"]}]}},cinematic:{drama:{components:[{type:"object",text:"Look at you",x:.5,y:.5,size:90,delay:200,fadeIn:!0,fadeOut:!0},{type:"object",text:"Look..",x:.5,y:.8,size:80,delay:2e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"..what you did",x:.5,y:.9,size:80,delay:4e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"Just because you look at you",x:.5,y:.8,size:80,delay:7e3,fadeIn:!0,fadeOut:!0},{type:"object",text
:"and nothing else",x:.5,y:.8,size:80,delay:9e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"every day, every things..",x:.5,y:.9,size:80,delay:11e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"..are left",x:.5,y:.8,size:80,delay:12500,fadeIn:!0,fadeOut:!0},{type:"object",text:"You forget the simple thing ever..",x:.5,y:.9,size:80,delay:17e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"Look things as they are",x:.5,y:.8,size:80,delay:2e4,fadeIn:!0,fadeOut:!0},{type:"object",text:" ",x:.5,y:.8,size:80,delay:22e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"Who knows ?",x:.5,y:.6,size:120,delay:24e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"It could be different",x:.5,y:.6,size:120,delay:28e3,fadeIn:!0,fadeOut:!0}]},happy:{components:[{type:"object",text:"You finally open your eyes",x:.5,y:.5,size:90,delay:200,fadeIn:!0,fadeOut:!0},{type:"object",text:"Look..",x:.5,y:.8,size:80,delay:2e3,fadeIn:!0,fadeOut:!0},{type:"action",target:"player",what:"axes",val:{x:.5,y:0},delay:2200},{type:"object",text
:"..this is your world",x:.5,y:.9,size:80,delay:4e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"But you just ignore it",x:.5,y:.8,size:80,delay:9e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"every day",x:.5,y:.9,size:80,delay:11e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"get bored by your life, and your work",x:.5,y:.8,size:80,delay:14e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"You forget the simple thing ever..",x:.5,y:.9,size:80,delay:18e3,fadeIn:!0,fadeOut:!0},{type:"object",text:"Look things as they are",x:.5,y:.6,size:120,delay:22e3,fadeIn:!0,fadeOut:!0}]},game_over:{components:[{type:"object",text:"Game Over",x:.5,y:.5,size:140,delay:200,fadeIn:!0,fadeOut:!0}]}}};return e}),define("Character",["datas","DREAM_ENGINE"],function(e,t){function n(n,r,i,s,o,u){if(!s)return;t.GameObject.call(this,{x:n,y:r,zindex:11,tag:i,renderer:new t.SpriteRenderer({spriteName:s}),collider:new t.FixedBoxCollider(o,u)}),this.moveSpeed=e.player.moveSpeed,this.jumpForce=e.player.jumpForce,this.mass=e.player
.mass,this.axes={x:0,y:0},this.gravity={x:0,y:0},this.onFloor=!1,this.dir=0,this.startedX=n,this.startedY=r,this.init=function(){},this.customBefore=function(){},this.customAfter=function(){},this.life=e.mob.life;var a=this;this.logic=function(){this.isReplay&&this.replay(),this.customBefore(),this.move(),this.makeCollision(),this.customAfter()},this.move=function(){var t=this.axes.x;this.isReplay&&this.targetX>this.position.x&&(t=1),t<0?this.dir=-1:t>0&&(this.dir=1);var n=this.mass*this.gravity.y*e.coefAirFriction>>0;this.gravity.y+=Math.abs(this.gravity.y*this.mass)>e.maxAttractionForce?0:e.attractionForce,this.gravity.y=(this.gravity.y*100>>0)/100;var r=this.mass*this.gravity.x*e.coefAirFriction>>0;this.onFloor&&(this.gravity.x*=e.coefFloorReductor),this.gravity.x=(this.gravity.x*100>>0)/100;var i=this.getPos();this.previousMove={x:r||t*this.moveSpeed,y:n},this.previousPosition={x:i.x,y:i.y},this.translate({x:r||t*this.moveSpeed,y:n}),this.getAnimation(t)},this.getRenderer=function()
{return this.renderers[0]},this.getAnimation=function(e){var t=this.getRenderer();this.hitting?(t.setFrame(0),t.setLine(this.dir<0?5:4)):this.hurted?t.isOver&&this.onFloor&&this.endHurt():this.onFloor?(e!=0?t.setPause(!1):(t.setPause(!0),t.setFrame(0)),t.setLine(this.dir<0?1:0)):(t.setPause(!0),t.setFrame(0),t.setLine(this.dir<0?3:2))},this.makeCollision=function(){var e=this.scene.collideObjects,n=this.collider.getRealPosition(),r=n.y,i=n.x,s=n.x+this.collider.width,o=n.y+this.collider.height,u={l:0,r:0,t:0,b:0};for(var a=0,f,l,c;a<e.length;++a,f=!1){l=e[a];if(l.name=="mirror")this.tag=="player"&&t.CollisionSystem.pointCircleCollision(this.position,l.collider)&&this.scene.trigger("WIN_TWIST");else if(t.CollisionSystem.fixedBoxCollision(this.collider,l.collider)){c=l.collider.getRealPosition();var h=c.y,p=c.x,d=c.x+l.collider.width,v=c.y+l.collider.height,m=s-p<0?0:s-p+1>>0,g=i-d>0?0:-(i-d-1)>>0,y=r-v>0?0:-(r-v)>>0,b=o-h<0?0:o-h>>0;f=this.checkHCol(m,g,y,b,u),f||(f=this.checkVCol(m,g,y,
b,u)),f||(f=this.checkHCol(m,g,y,b,u))}}},this.checkHCol=function(e,t,n,r,i){if(e>0&&(!n||e<n)&&(!r||e<r)||t>0&&(!n||t<n)&&(!r||t<r))return t<e&&i.r||e<t&&i.l?(this.position.x-=e<t?e:-t,t=0,e=0,!1):(i.l=t<e,i.r=e<t,this.position.x-=e<t?e:-t,!0)},this.checkVCol=function(e,t,n,r,i){if(n>0&&(!e||n<e)&&(!t||n<t)&&!i.t||r>0&&(!e||r<e)&&(!t||r<t)&&!i.b)return r<n&&i.t||n<r&&i.b?(n=0,r=0,!1):(i.t=n<r,i.b=r<n,this.position.y-=r<n?r:-n,this.gravity.y=0,r<n&&(this.onFloor||this.trigger("onFloor"),this.onFloor=!0),!0)},this.jump=function(e){this.addHistory("jump",{isCall:!0},Date.now()),this.onFloor=!1,this.gravity.y=this.jumpForce},this.history=[],this.addHistory=function(e,t,n){if(this.isReplay)return;var r={whatChange:e,time:n-this.scene.startedAt};for(var i in t)r[i]=t[i];this.history.push(r)},this.currentReplay=0,this.replay=function(){var e=this.history[this.currentReplay];if(!e){this.isReplay=!1;return}if(t.Time.currentTime-this.scene.startedAt<=e.time)return;e.x!=undefined?(this[e.whatChange
].x=e.x,this[e.whatChange].y=e.y,this.tag!="mob"&&(this.targetX=e.px)):this[e.whatChange](),this.currentReplay++},this.startReplay=function(){this.currentReplay=0,this.disable=!1,this.isReplay=!0,this.position.x=this.startedX,this.position.y=this.startedY,this.life=e.mob.life},this.addAutomatism("logic",{type:"logic"}),this.init()}return n.prototype=new t.GameObject,n.prototype.constructor=n,n.prototype.supr=t.GameObject.prototype,n}),define("Player",["datas","DREAM_ENGINE","DE.GamePad","Character"],function(e,t,n,r){function i(e,n,i){r.call(this,e,n,"player","player",50,150);var s=new t.SpriteRenderer({spriteName:"player-w",offsetX:15,offsetY:-40}),o=this.renderers[0];this.power=50,this.hasWeapon=!1,this.target=i,this.killerZone=new t.GameObject({y:-50,collider:new t.CircleCollider(80)}),this.add(this.killerZone),this.killerZone.disable=!0,this.powerUp=function(e,t){if(this.isReplay)return;var n=(this.power*.1>>0)*10;this.power+=e;if(this.power==0&&this.target){this.trigger("no_dead");
return}if(this.power<0){this.trigger("dead");return}this.power>100&&(this.power=100),t&&(this.power=e);var r=(this.power*.1>>0)*10;r!=n&&this.scene.trigger("POWER_UP",r,n)},this.customBefore=function(){this.onFloor&&(t.Inputs.key("jump")||t.Inputs.key("up"))&&this.jump()},this.customAfter=function(){this.checkHit(this.hitting),this.checkSpawner(),this.position.x<this.camera.realposition.x+30&&(this.position.x=this.camera.realposition.x+30)},this.action=function(){this.addHistory("action",{isCall:!0},Date.now()),this.hasWeapon?(this.hitting=!0,this.killerZone.disable=!1,this.killerZone.position.x=50*this.dir,this.addAutomatism("endHit",{type:"endHit",interval:50})):t.CollisionSystem.pointCircleCollision(this.getPos(),this.target.collider)&&(this.target.disable=!0,this.target=null,this.hasWeapon=!0,o=this.renderers[0],this.renderers[0]=s)},this.removeKatana=function(){this.renderers[0]=o,this.hasWeapon=!1,this.target=i,this.target.disable=!1,this.killerZone.disable=!0},this.endHit=function(
){this.removeAutomatism("endHit"),this.hitting=!1,this.killerZone.disable=!0},this.lastHurt=Date.now(),this.delayHurt=50,this.checkHit=function(e){var n=this.scene.mobs,r=!1;for(var i=0,s;i<n.length;++i)s=n[i],e&&!s.disable&&t.CollisionSystem.circleCollision(this.killerZone.collider,s.weakCollider.collider)?(r=!0,s.getDamage(this),this.powerUp(.1),s.life==0&&this.powerUp(1),this.camera.shake(30,30,30)):Date.now()-this.lastHurt>this.delayHurt&&t.CollisionSystem.fixedBoxCollision(this.collider,s.collider)&&(this.lastHurt=Date.now(),this.target?this.powerUp(0,!0):this.powerUp(-1));e&&(r?t.AudioManager.fx.play("hit"):t.AudioManager.fx.play("empty_hit"))},this.checkSpawner=function(){var e=this.scene.spawners;for(var n=0,r;n<e.length;++n)r=e[n],!r.disable&&t.CollisionSystem.pointCircleCollision(this.getPos(),r.collider)&&r.trigger("collision")};var u=this;t.Inputs.on("keyDown","action",function(){u.action()}),t.Inputs.on("axeMoved","haxe",function(e){u.updateAxes(e,undefined)}),t.Inputs.on("axeMoved"
,"vaxe",function(e){u.updateAxes(undefined,e)}),t.Inputs.on("axeStop","haxe",function(){u.updateAxes(0,undefined)}),t.Inputs.on("axeStop","vaxe",function(){u.updateAxes(undefined,0)}),t.Inputs.on("keyUp","left",function(){t.Inputs.key("right")||u.updateAxes(0)}),t.Inputs.on("keyUp","right",function(){t.Inputs.key("left")||u.updateAxes(0)}),t.Inputs.on("keyDown","left",function(){u.updateAxes(-1)}),t.Inputs.on("keyDown","right",function(){u.updateAxes(1)})}return i.prototype=new r,i.prototype.constructor=i,i.prototype.supr=r.prototype,i.prototype.updateAxes=function(e,n){this.axes={x:e!==undefined?e:this.axes.x,y:n!==undefined?n:this.axes.y},this.addHistory("axes",{x:this.axes.x,y:this.axes.y,px:this.position.x},t.Time.currentTime)},i}),define("Filter",["DREAM_ENGINE"],function(e){function t(t,n){n=n||{};var r=null;n.isTile?r=new e.TileRenderer({imageName:t,w:n.component.w,h:n.component.h,tilesizes:{w:n.component.tw||n.component.w,h:n.component.th||n.component.h},tileposition:{x:n.component
.sx,y:n.component.sy}}):r=new e.SpriteRenderer({spriteName:t,scale:n.scale||1}),e.GameObject.call(this,{x:n.offsetX||0,y:n.offsetY||0,renderer:r}),this.opacityStep=.01,this.lowerOpacity=.1,this.higherOpacity=.3,this.fadeDir=1,this.fade=function(){var e=this.renderers[0];e.alpha+=this.opacityStep*this.fadeDir,e.alpha<this.lowerOpacity?(e.alpha=this.lowerOpacity,this.fadeDir=1):e.alpha>this.higherOpacity&&(e.alpha=this.higherOpacity,this.fadeDir=-1)},this.addAutomatism("fade",{type:"fade",interval:135}),this.onPowerChange=function(e,t){this.higherOpacity=e*.01,this.lowerOpacity=e*.01-.2,e==0?this.disable=!0:this.disable=!1}}return t.prototype=new e.GameObject,t.prototype.constructor=t,t.prototype.supr=e.GameObject.prototype,t}),define("Enemy",["datas","DREAM_ENGINE","Character","Filter"],function(e,t,n,r){function i(r,i,s){n.call(this,r,i,"mob","monster",70,130);var o=new t.SpriteRenderer({spriteName:"boy"});this.renderers[0].onAnimEnd=function(){this.gameObject.hurtable=!0},this.weakCollider=new 
t.GameObject({collider:new t.CircleCollider(40)}),this.add(this.weakCollider),this.maxX=this.position.x,this.hurtAnimDelay=100,this.hurtable=!0,this.moveSpeed=e.mob.moveSpeed,this.jumpForce=e.mob.jumpForce,this.mass=e.mob.mass,this.switchRenderer=function(){this.renderers[0]=o},this.customBefore=function(){if(!this.onFloor)return;!this.isReplay&&this.position.x>this.maxX&&(this.axes.x=-1)},this.changeDir=function(){if(this.isReplay)return;this.axes.x=Math.random()*2>>0==1?1:-1,this.addHistory("axes",{x:this.axes.x,y:this.axes.y,px:this.position.x},t.Time.currentTime),this.addAutomatism(Date.now().toString(),{type:"changeDir",interval:Math.random()*1450>>0,persistant:!1})},this.addAutomatism("dir",{type:"changeDir",interval:Math.random()*1450>>0,persistant:!1}),this.customAfter=function(){},this.getDamage=function(e){if(!this.isReplay&&!this.hurtable)return;this.axes.x=0,this.gravity.y=-2,this.gravity.x=1*(this.position.x>e.position.x?1:-1),this.onFloor=!1,this.life--;var t=this.getRenderer
();t.currentLine<2&&t.setLine(t.currentLine+=2),this.hurted=!0,this.hurtable=!1,t.setEndFrame(2),t.setDelay(this.hurtAnimDelay),t.setLoop(!1),t.setPause(!1),t.restartAnim()},this.endHurt=function(){this.changeDir(),this.hurted=!1;var e=this.getRenderer();e.setDelay(t.ImageManager.images[e.spriteName].eachAnim),e.setEndFrame(t.ImageManager.images[e.spriteName].totalFrame),e.setLoop(!0),e.restartAnim(),this.life<=0&&(this.disable=!0)}}return i.prototype=new n,i.prototype.constructor=i,i.prototype.supr=n.prototype,i}),define("MobSpawner",["DREAM_ENGINE","Enemy"],function(e,t){function n(n){e.GameObject.call(this,{x:n.x,y:n.y,tag:"spawn",collider:new e.CircleCollider(n.radius)});var r=n.mobs;this.spawn=function(){for(var e=0;e<r.length;++e){var n=new t(this.position.x,this.position.y,r[e]);this.scene.add(n),this.scene.mobs.push(n),this.scene.winned&&n.switchRenderer(),n.init()}this.askToKill()},this.on("collision",this.spawn,this)}return n.prototype=new e.GameObject,n.prototype.constructor=
n,n.prototype.supr=e.GameObject.prototype,n}),define("levelManager",["DREAM_ENGINE","datas","MobSpawner","Filter"],function(e,t,n,r){var i=new function(){this.generateEnvironment=function(i,s){var o=t.levels[1].components;for(var u=0;u<o.length;++u){var a=o[u],f=t.components[a.name],l=null;f.sx!=undefined?l=new e.TileRenderer({imageName:f.sprite,w:f.w,h:f.h,tilesizes:{w:f.tw||f.w,h:f.th||f.h},tileposition:{x:f.sx,y:f.sy}}):l=new e.SpriteRenderer({spriteName:f.sprite,w:f.w,h:f.h}),a.zindex<0&&(l.imageName="s"+f.sprite);var c=undefined;f.collider&&a.zindex>=0&&a.zindex<=9&&(f.collider.type=="circle"?c=new e.CircleCollider(f.collider.r,{offsetLeft:f.collider.l,offsetTop:f.collider.t}):c=new e.FixedBoxCollider(f.collider.w,f.collider.h,{offsetLeft:f.collider.l,offsetTop:f.collider.t})),a.name=="mirror"&&(c=new e.CircleCollider(500));var h=new e.GameObject({name:a.name,tag:f.tag,x:a.x,y:a.y,zindex:a.zindex||f.zindex,renderer:l,collider:c});i.add(h),h.filter=new r(f.sprite+"_evil",{isTile:!0,
component:f}),h.add(h.filter),i.on("POWER_UP",h.filter.onPowerChange,h.filter),h.collider&&i.collideObjects.push(h)}var p=t.levels[1].mobs;for(u=0;u<p.length;++u){var d=new n(p[u]);i.spawners.push(d),i.add(d)}s.limits.minX=0,s.limits.maxX=9800}};return i}),define("Game",["DREAM_ENGINE","Player","Enemy","datas","levelManager"],function(e,t,n,r,i){var s={};return s.init=function(){console.log("Engine init"),e.CONFIG.DEBUG_LEVEL=1,s.render=new e.Render("render",{fullScreen:"ratioStretch"}),s.render.init(),s.scene=new e.Scene("Test"),s.camera=new e.Camera(s.screen.w,s.screen.h,0,0,{name:"Test zoom 100%",backgroundColor:"#ea995d",minX:0,maxX:4e3,minY:0,maxY:1080}),s.camera.scene=s.scene,s.render.add(s.camera),e.start()},s.screen={w:1920,h:1080},s.start=function(){var t=new e.GameObject({x:960,y:750,zindex:200,renderers:[new e.TextRenderer({fontSize:90},600,300,"Start")],collider:new e.FixedBoxCollider(350,120)});t.onMouseUp=function(){s.replay()},s.scene.add(t),s.scene.collideObjects=[],s.scene
.mobs=[],s.scene.spawners=[],i.generateEnvironment(s.scene,s.camera),s.scene.trigger("POWER_UP",0),e.AudioManager.music.stopAllAndPlay("drama"),s.scene.on("WIN_TWIST",s.winTwist,s),setTimeout(function(){e.States.down("isLoading")},200)},s.replay=function(){s.winned=!1,s.scene.winned=!1,s.isCinematic=!1,e.Inputs.keyLocked=!1,s.scene.deleteAll(),s.scene.collideObjects=[],s.scene.mobs=[],s.scene.spawners=[];var r=new e.GameObject({x:370,y:850,tag:"katana",zindex:10,renderer:new e.SpriteRenderer({spriteName:"katana"}),collider:new e.CircleCollider(150)});s.scene.add(r),s.player=new t(100,-100,r),s.player.camera=s.camera,s.player.on("no_dead",s.win,s),s.player.on("dead",s.gameOver,s),s.camera.focus(s.player,{y:!0}),s.scene.add(s.player),i.generateEnvironment(s.scene,s.camera),s.scene.startedAt=Date.now();var o=new n(2080,750);o.removeAutomatism("dir"),o.axes.x=-1,s.scene.mobs.push(o),s.scene.add(o),o.addHistory("axes",{x:-1,y:0,px:2080},e.Time.currentTime),e.AudioManager.music.stopAllAndPlay
("psycho")},s.gameOver=function(){if(s.winned)return;s.winned=!0,s.player.axes={x:0,y:0},s.startCinematic("game_over")},s.win=function(){if(s.winned)return;s.winned=!0;var t=s.scene.gameObjects;s.scene.winned=!0;for(var n=0;n<t.length;++n)t[n].tag=="mob"&&t[n].switchRenderer(),t[n].filter&&(t[n].filter.disable=!0,t[n].childrens=[]),t[n].axes&&(t[n].axes={x:0,y:0});e.AudioManager.music.stopAllAndPlay("happy"),s.startCinematic("happy")},s.winTwist=function(){if(s.winned)return;s.winned=!0,s.scene.winned=!0,e.AudioManager.music.stopAllAndPlay("drama");var t=new e.GameObject({x:s.camera.realposition.x+s.camera.sizes.width/2>>0,y:s.camera.realposition.y+s.camera.sizes.height/2>>0,zindex:11,renderer:new e.BoxRenderer({fillColor:"black"},s.camera.sizes.width,s.camera.sizes.height)});s.scene.add(t),s.startCinematic("drama"),setTimeout(function(){t.askToKill(),s.startReplay()},2e3)},s.startReplay=function(){e.Inputs.keyLocked=!0,s.camera.limits.minX=0,s.player.powerUp(0,!0);var t=s.scene.gameObjects
;for(var n=0;n<t.length;++n)t[n].history&&t[n].startReplay(),t[n].tag=="mob"&&t[n].switchRenderer(),t[n].filter&&(t[n].filter.disable=!0,t[n].childrens=[]),t[n].axes&&(t[n].axes={x:0,y:0});s.player.position.y=-100,s.player.removeKatana(),s.scene.startedAt=Date.now()},s.startCinematic=function(t){e.Inputs.keyLocked=!0,s.cinematic=r.cinematic[t],s.cinematic.startedAt=Date.now(),s.cinematic.current=0,s.isCinematic=!0},s.calcCinematic=function(t){if(!s.isCinematic)return;var n=s.cinematic;if(t-n.startedAt<n.components[n.current].delay)return;var r=n.components,i=r[n.current];if(n.current>0&&i.type=="object"){var o=r[n.current-1];o.type!="object"&&(o=r[n.current-2]),o.fadeOut?o.obj.addAutomatism("fade",{type:"fade",value1:-1}):o.obj.askToKill()}if(i.type=="object"){var u=new e.GameObject({zindex:100,renderer:new e.TextRenderer({fontSize:i.size},1800,400,i.text)});u.coefX=i.x,u.coefY=i.y,u.targetCam=function(){this.position.x=s.camera.realposition.x+s.camera.sizes.width*this.coefX>>0,this.position
.y=s.camera.realposition.y+s.camera.sizes.height*this.coefY>>0},u.addAutomatism("tar",{type:"targetCam"}),u.fade=function(e){this.renderers[0].alpha+=.025*e;if(e>=1&&this.renderers[0].alpha>=1||e<=0&&this.renderers[0].alpha<=0)this.removeAutomatism("fade"),e<=0&&this.askToKill()},i.fadeIn&&(u.addAutomatism("fade",{type:"fade",value1:1}),u.renderers[0].alpha=.1),s.scene.add(u),r[n.current].obj=u}else i.type=="action"&&(console.log("action"),s[i.target][i.what]=i.val,console.log(s[i.target][i.what]));n.current++,n.current==n.components.length&&(s.isCinematic=!1,s.end())},s.end=function(){e.Inputs.keyLocked=!0;var t=new e.GameObject({x:s.camera.realposition.x+1600,y:900,zindex:200,renderers:[new e.TextRenderer({fontSize:50},200,100,"Replay")],collider:new e.FixedBoxCollider(300,100)});t.onMouseUp=function(){s.replay()},s.scene.add(t);var n=new e.GameObject({x:s.camera.realposition.x+400,y:60,zindex:200,renderer:new e.TextRenderer({fontSize:50},700,100,"Global Game Jam 2014")});s.scene.add(
n);var r=new e.GameObject({x:s.camera.realposition.x+960,y:1010,zindex:200,renderer:new e.TextRenderer({fontSize:40},1200,100,"by Ludovic Servat and Antoine Rogliano")});s.scene.add(r)},window.Game=s,s}),define("gameLoop",["DREAM_ENGINE","Game"],function(e,t){function n(e){t.camera.limits.minX=t.camera.realposition.x,t.calcCinematic(e),t.winned&&t.player&&t.player.position.x>8700&&(t.player.axes={x:0,y:0})}return n}),define("DE.imagesDatas",["DE.CONFIG"],function(e){var t={screenSizes:[{w:1920,h:1080,path:""}],conceptionSizeIndex:0,folderName:"img",imagesList:[["player","player","png",{load:!0,totalFrame:8,totalLine:4,eachAnim:70,isAnimated:!1}],["player-w","player-w","png",{load:!0,totalFrame:8,totalLine:6,eachAnim:70,isAnimated:!0}],["boy","boy","png",{load:!0,totalFrame:8,totalLine:4,eachAnim:105,isAnimated:!1}],["monster","monster","png",{load:!0,totalFrame:8,totalLine:4,eachAnim:105,isAnimated:!1}],["hellboy","hellboy","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back"
,"back","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back_evil","back_evil","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back1","back1","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back1_evil","back1_evil","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back2","back2","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back2_evil","back2_evil","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back3","back3","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["back3_evil","back3_evil","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}],["katana","katana","png",{load:!0,totalFrame:1,totalLine:1,isAnimated:!1}]]};return e.debug.log("imagesDatas loaded",3),t}),define("DE.audiosList",["DE.CONFIG"],function(e){var t=[["psycho","sd/musics/Danger",["ogg","mp3"],{preload:!0,loop:!0,isMusic:!0}],["drama","sd/musics/DancingCheekToCheek",["mp3"],{preload:!0,loop:!0,isMusic:!0}],["happy","sd/musics/Lullaby",["ogg","mp3"],{preload
:!0,loop:!0,isMusic:!0}],["empty_hit","sd/fxs/empty_hit",["ogg","mp3"],{preload:!0,loop:!1,isMusic:!1}],["hit","sd/fxs/hit",["ogg","mp3"],{preload:!0,loop:!1,isMusic:!1}],["fatal_heart","sd/fxs/heart_fast",["ogg","mp3"],{preload:!0,loop:!1,isMusic:!1}]];return e.debug.log("audioList loaded",3),t}),define("DE.inputsList",["DE.CONFIG"],function(e){var t={left:{keycodes:["K.left","K.a","K.q"]},right:{keycodes:["K.right","K.d"]},up:{keycodes:["K.up","K.z","K.w"]},down:{keycodes:["K.down","K.s"]},haxe:{keycodes:["G0.A.LHorizontal"]},vaxe:{keycodes:["G0.A.LVertical"]},action:{keycodes:["K.space","G0.B.A"],interval:200},jump:{keycodes:["G0.B.B"],interval:100},confirm:{keycodes:["K.enter","G0.B.A"],interval:500},back:{keycodes:["K.escape","G0.B.B"],interval:500}};return e.debug.log("inputsList loaded",3),t}),define("DE.dictionary",["DE.CONFIG"],function(e){var t={en:{loose:"You are dead",replay:"Replay ?",play:"Play",benchmark:"Run benchmark"},fr:{loose:"Vous \u00eates mort",replay:"Rejouer ?",
play:"Jouer",benchmark:"Lancer le test"}};return e.debug.log("dictionary loaded",3),t}),define("main",["gameLoop","Game","DE.imagesDatas","DE.audiosList","DE.inputsList","DE.dictionary"],function(e,t,n,r,i,s){function o(o){o.init({customLoop:e,onReady:t.init,onStart:t.start,loader:{scale:2},images:n,audios:r,inputs:i,dictionary:s})}return o});